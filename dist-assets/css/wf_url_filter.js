!function(module,$){"use strict";function launch_url_filter_dialog(urlfilter_entries,is_wf_adv_visible,operation,source_index,is_dns){var is_edit=operation===OPERATIONS.EDIT,title=is_dns?is_edit?$.getInfo("Edit Domain Filter"):$.getInfo("New Domain Filter"):is_edit?$.getInfo("Edit URL Filter"):$.getInfo("New URL Filter"),is_sniffer="sniffer-profile"===$("#name").val()&&$("#name").is(":disabled"),$dialog=$("#url_filter_dialog"),$type_field=$("#url_filter_type"),$action_field=$("#url_filter_action"),$status_field=$("#url_filter_status"),$referrer_host_field=is_wf_adv_visible?$("#url_filter_referrer_host"):null,$form=$dialog.find("form"),uf_profile=is_edit?urlfilter_entries[source_index]:{},sniffer_actions=["allow","monitor"];if($action_field.find("input").each(function(index,elem){var $elem=$(elem);is_sniffer&&sniffer_actions.indexOf($elem.val())===-1&&$elem.parent().hide()}),is_edit){is_dns?$(".url_filter_url").val(uf_profile.domain):$(".url_filter_url").val(uf_profile.url);var $selectedType=$type_field.find("input[value="+uf_profile.type+"]");$selectedType.check().trigger("focus"),$selectedType.change(),$action_field.find("input[value="+uf_profile.action+"]").check().parent().show(),$status_field.check("enable"===uf_profile.status),is_wf_adv_visible&&$referrer_host_field.val(uf_profile["referrer-host"])}else{$(".url_filter_url").val("");var $defaultType=$type_field.find('input[value="simple"]');$defaultType.check().trigger("focus"),$defaultType.change(),$action_field.find(is_sniffer?'input[value="allow"]':is_dns?'input[value="block"]':'input[value="exempt"]').check(),$status_field.check(),is_wf_adv_visible&&$referrer_host_field.val("")}$form.submit(function(){return!1}),$type_field.find("input").on("focus",function(){var url=$(".url_filter_url:visible").val();$("#url_filter_url_hidden").val(url)}).change(function(){$(".url_filter_url:visible").val($("#url_filter_url_hidden").val()).focus()}),$dialog.dialog({title:title,resizable:!1,minWidth:550,modal:!0,buttons:[{text:$.getInfo("ok"),click:function(){$(".url_filter_url:hidden").val(""),$form.valid()&&(is_dns?uf_profile.domain=$(".url_filter_url:visible").val():uf_profile.url=$(".url_filter_url:visible").val(),uf_profile.type=$type_field.find("input:checked").val(),uf_profile.action=$action_field.find("input:checked").val(),uf_profile.status=$status_field.is(":checked")?"enable":"disable",is_wf_adv_visible&&(uf_profile["referrer-host"]=$referrer_host_field.val()),operation===OPERATIONS.CREATE?urlfilter_entries.push(uf_profile):operation===OPERATIONS.EDIT?urlfilter_entries[source_index]=uf_profile:operation===OPERATIONS.INSERT_ABOVE?urlfilter_entries.splice(source_index,0,uf_profile):urlfilter_entries.splice(source_index+1,0,uf_profile),$(this).dialog("destroy"),$(".url_filter_url").val(""),gen_urlfilter_qlist(urlfilter_entries,is_wf_adv_visible,is_dns))}},{text:$.getInfo("cancel"),click:function(){$(this).dialog("destroy")}}]})}function gen_urlfilter_qlist(urlfilter_entries,is_wf_adv_visible,is_dns){function UrlFilterListMenuController($scope,$rootScope){urlFilterMenuReset||(urlFilterMenuReset=function(){$rootScope.qlistElem={element:$("#website_filter")}})(),$scope.editEnabled=!1,$scope.create=function(){launch_url_filter_dialog(urlfilter_entries,is_wf_adv_visible,OPERATIONS.CREATE,null,is_dns)},$scope.insertAbove=function(){var index=$scope.qlistElem.element.find("tr.selected").data("sourceIndex");launch_url_filter_dialog(urlfilter_entries,is_wf_adv_visible,OPERATIONS.INSERT_ABOVE,index,is_dns)},$scope.insertBelow=function(){var index=$scope.qlistElem.element.find("tr.selected").data("sourceIndex");launch_url_filter_dialog(urlfilter_entries,is_wf_adv_visible,OPERATIONS.INSERT_BELOW,index,is_dns)},$scope.edit=$scope.menu.qlistDoubleClickHandler=function(){var index=$scope.qlistElem.element.find("tr.selected").data("sourceIndex");launch_url_filter_dialog(urlfilter_entries,is_wf_adv_visible,OPERATIONS.EDIT,index,is_dns)},$scope.delete=function(){var rows=$scope.qlistElem.element.find("tr.selected").toArray(),indices=rows.map(function(row){return $(row).data("sourceIndex")});indices.sort(function(a,b){return b-a}),indices.forEach(function(index){urlfilter_entries.splice(index,1)}),gen_urlfilter_qlist(urlfilter_entries,is_wf_adv_visible,is_dns)},$scope.$watch("menu.lastSelectedEntry",function(entry){if(entry){var singleSelected=$scope.menu.entries&&1===$scope.menu.entries.length;$scope.canEdit=singleSelected,$scope.canDelete=!!$scope.menu.entries||0!==$scope.menu.entrie.length}})}var columns=[{selector:"type"},{selector:"action"},{selector:"status"}];is_dns?columns.unshift({selector:"domain",validate:"required",lang_key:"domain"}):columns.unshift({selector:"url",validate:"required",lang_key:"url"}),is_wf_adv_visible&&!is_dns&&columns.push({selector:"referrer-host"});var qlist_settings={source:urlfilter_entries,prefix:"website_filter_url_filter",search:{enabled:!0},columns:columns,default_columns:columns.map(function(column){return column.selector}),options:{inline:!0},reordering:{enable:is_rw_admin,onDrop:function(to,from,nearby){var from_entry=urlfilter_entries[from];urlfilter_entries.splice(from,1),urlfilter_entries.splice(to,0,from_entry),gen_urlfilter_qlist(urlfilter_entries,is_wf_adv_visible,is_dns)}},paging:{enabled:urlfilter_entries.length>gui_lines_per_page},format_fn:{type:function(td,column,row){return"<span>"+$.getInfo(row.type)+"</span>"},action:function(td,column,row){return td.addClass("left"),fweb.util.icon.formatIcon(fweb.util.icon.ICON_TYPE.URL_FILTER_ACTION,row.action,{label:$.getInfo(row.action)})},status:function(td,column,row){return td.addClass("left"),fweb.util.icon.formatIcon(fweb.util.icon.ICON_TYPE.ENABLE_DISABLE,row.status,{label:$.getInfo(row.status)})},url:function(td,column,row){$(td).addClass("left");var value=row[column.selector];return fweb.util.formatters.truncate_comment(value,50,"qtip-popup")},domain:function(td,column,row){$(td).addClass("left");var value=row[column.selector];return fweb.util.formatters.truncate_comment(value,50,"qtip-popup")}}};require(["angular","jquery.ng_app"],function(angular){if($("#website_filter").empty().removeData().qlist(qlist_settings),$("#website_filter").find(".qtip-popup").ftip(),urlFilterMenuReset)urlFilterMenuReset();else{var ngModule=angular.module("UrlFilterListMenu",[]);ngModule.controller("UrlFilterListMenuController",UrlFilterListMenuController),$("[f-ng-app=qlistMenuBarUrlFilterTableMenu]").ng_app({modules:[ngModule.name]})}})}function setupFortiGuardCatsHandlers(ftgdCat,is_licensed,is_dns){function filter_actions(entry){var source,act_sniffer=["all","allow","monitor"],act_basic=[].concat(act_sniffer,["block"]),act_full=[].concat(act_basic,["warning","authenticate"]),is_flow=$("#mode_flow").is(":checked"),is_sniffer="sniffer-profile"===$("#name").val()&&$("#name").is(":disabled");return source=is_sniffer?act_sniffer:is_flow||is_dns?act_basic:act_full,source.indexOf(entry.q_origin_key)>-1}function on_action_filter_change(){var selected=omniselects.action_filter.getSelected(),value=selected&&selected[0]&&selected[0].name||"all";ftgdCat.filterCatsByAction(value)}function on_inspection_mode_change(){var show_warn=$("#ftgd_ftgd_cats").is(":checked"),is_flow=$("#mode_flow").is(":checked");is_flow&&ftgdCat.transformAction(["authenticate","warning"],"block",show_warn),omniselects.action_filter.update({reProcess:!0})}var ftgd_warn=1;$("#treeDivCat").on("click","f-icon.fa-pencil-square-o",function(){var id=$(this).closest("li").prop("id");return ftgdCat.tree.check_node(id),ftgdCat.repmsg_dialog(),!1});var $ftgd_cats_toggle=$("#ftgd_ftgd_cats"),handle_ftgd_cats=function(){$ftgd_cats_toggle.is(":checked")&&ftgd_warn&&!is_licensed&&(fweb.util.slide.alert("<p>"+$.getInfo("warn_not_licensed_1")+"</p><p>"+$.getInfo("warn_not_licensed_2")+"</p>",fweb.util.slide.LEVEL.WARNING),ftgd_warn=0)};$ftgd_cats_toggle&&$ftgd_cats_toggle.length>0&&($ftgd_cats_toggle.click(handle_ftgd_cats),handle_ftgd_cats());var omniselects={},$inspection_mode=$("input[name=inspection-mode]"),$action_filter=$("#sel_action_filter");$action_filter.val(JSON.stringify([{q_origin_key:"all",name:"all",datasource:"fortiGuardCategoryActions"}])),omniselects.action_filter=$action_filter.omniselect({sources:["fortiGuardCategoryActions"],preProcessSelected:!0,singleSelect:!0,filterFunction:filter_actions}).omniselect("getInstance"),$action_filter.change(on_action_filter_change),$inspection_mode.length&&$inspection_mode.change(on_inspection_mode_change)}var OPERATIONS={CREATE:"create",EDIT:"edit",DELETE:"delete",INSERT_ABOVE:"insert_above",INSERT_BELOW:"insert_below"},fweb_util_slide=fweb.util.slide;module.launch_url_filter_dialog=launch_url_filter_dialog;var urlFilterMenuReset;module.gen_urlfilter_qlist=gen_urlfilter_qlist,module.setupFortiGuardCatsHandlers=setupFortiGuardCatsHandlers,$(document).ready(function(){var $msg=$(".botnet-database-msg"),dbdb_pkg=fgd_common.PACKAGES.DBDB;fgd_common.gen_stat_inline_message_for(dbdb_pkg).then(function(msg_html){$msg.html(msg_html).removeClass("hide"),$("a",$msg).click(function(e){e.preventDefault(),fweb_util_slide.iframe(dbdb_pkg.url.details,{buttons:!1,title:$.getInfo("Botnet C&C Definitions")})})}),fgd_common.get_license_status_for(dbdb_pkg).then(function(status){var has_license=status===fweb.BUILD.SYMBOLS.LICENSE_STATUS_LICENSED;$msg.toggleClass("info-message",has_license).toggleClass("warning-message",!has_license)})})}(window.WebfilterShared=window.WebfilterShared||{},jQuery);