var MAX_FRAG_TIME=150,FOCUSABLE_ROW_TABINDEX=1e4,NOT_QLIST_ATTRIBUTE="not-qlist";!function(a){"use strict";function b(a,b){var c,d,e=b.split("."),f=e.length;for(d=0;d<f;d++)c=e[d],null==a[c]&&(a[c]={}),a=a[c];return a}function c(){function b(c,f){e[c]||(f.push(c),e[c]=!0,a.each(d[c],function(c,d){if(a.inArray(d,f)>=0)throw new Error("Circular dependancy found on "+d);e[d]||b(d,f.slice(0))}),q.push(c),p[c]=!0)}var c,d,e,f=!1;for(c in a.qlist.ext)if(a.qlist.ext.hasOwnProperty(c)&&!p.hasOwnProperty(c)){f=!0;break}if(!f)return q;p={},q=[],d={},e={};for(c in a.qlist.ext)a.qlist.ext.hasOwnProperty(c)&&(d[c]=[],a.qlist.ext[c].depends&&a.merge(d[c],a.qlist.ext[c].depends));for(c in d)d.hasOwnProperty(c)&&b(c,[]);return q}function d(){var b,c,d;for(b in a.qlist.ext)if(a.qlist.ext.hasOwnProperty(b))for(c=a.qlist.ext[b].depends||[],d=0;d<c.length;++d)if(!a.qlist.ext.hasOwnProperty(c[d]))throw new Error("Missing dependancy for "+b+": "+c[d])}function e(e){d(),c(),a.each(q,function(c,d){var f=a.qlist.ext[d];if(null!=f.defaults&&a.extend(b(e,f.config_path),f.defaults),null!=f.core_defaults){var g=a.extend({},e.options,f.core_defaults.options);a.extend(e,f.core_defaults),e.options=g}})}function f(b,c,d,e){var f=j,g=d.state;return a.each(q,function(h,i){var j,k,l=a.qlist.ext[i];if(k=a.extend({$self:null!=g&&g[i]},d),null!=l.commands&&a.isFunction(j=l.commands[b]))return f=j.apply(l,a.merge([c,k||{}],a.makeArray(e).slice(1))),!1}),f}function g(c,d,e){if(!c.managed)return!0;if(!(null==c.enabled_config_path?b(e,c.config_path).enabled:b(e,c.enabled_config_path)))return!1;var f=!0;return"auto"===c.managed&&a.each(c.depends,function(a,b){if(!g(d[b],d,e))return f=!1,!1}),f}function h(b,c,d){var e=[].slice,f=arguments;d={core:d||{}};var h=d.core.state;a.each(q,function(i,j){var k,l,m=a.qlist.ext[j];g(m,a.qlist.ext,d.core.config)&&a.isFunction(m[b])&&(l=a.extend({$self:null!=h&&h[j]},d),k=d[j]=m[b].apply(m,[c,l].concat(e.call(f,3))),k instanceof m.constructor&&null!=h&&(h[j]=k))})}function i(b,c,d,e){var f=[].slice,h=arguments;return a.each(q,function(c,i){var j=a.qlist.ext[i];g(j,a.qlist.ext,d.config)&&a.isFunction(j[b])&&(e=j[b].apply(j,f.call(h,1)),h[3]=e)}),e}var j={};a.qlist||(a.qlist={format_fn:{}});var k,l=fweb.util.dom.getURIParamOnce,m=fweb.util.dom.try_JSON_parse,n=fweb.util.dom.renderTemplate,o=fweb.util.persist;a.fn.qlist=function(b,c){function d(){return Oa.options.mobile_style&&!Oa.options.inline}function g(){Ga()}function p(){if(Oa.paging.enabled){var b=a(La).find(".page_current").val();localStorage&&+b&&localStorage.setItem(Oa.prefix+"/current_page",b)}}function q(){La.find(".current-page").trigger("change",!0)}function r(a,b,c){for(var d,e=0;d=a[e];e++)if(d.id===b.id)return c&&(a[e]=b),a;return a.push(b),a}function s(a,b){var c,d=!1,e=[];return a.filterSection(function(a,b){return c=b.validate.call(this,a),!(d=!c)&&(a.logic.is=b.is,void(a.value&&a.value.join("")&&(e=r(e,a))))}),d||x(e),!1}function t(){o.remove(Oa.ck_name.column),Oa.chosen_columns=Oa.default_columns;var b=z(),c=b&&b.length>0;o.remove(Oa.ck_name.filter),La.trigger("reset_columns"),Oa.column_filters.enabled&&c&&a.isFunction(Oa.column_filters.server_side_reload)?Oa.column_filters.server_side_reload():a(La).qlist("reload")}function u(b){if(b.join(",")!==Oa.chosen_columns.join(",")){Oa.chosen_columns=b,b.length&&o.put(Oa.ck_name.column,b.join(","));var c=z(),d=a.grep(c,function(c){return a.inArray(c.id,b)>=0});d.length!==c.length?x(d):a(La).qlist("reload")}}function v(){var b=z(),c=b&&b.length>0;Oa.column_filters.value=[],o.remove(Oa.ck_name.filter);var d=a.Event("filters_cleared");La.trigger(d),Oa.column_filters.enabled&&c&&a.isFunction(Oa.column_filters.server_side_reload)?Oa.column_filters.server_side_reload():a(La).qlist("reload")}function w(){var b=a(La),c=b.data("qlist_state");if(b.find("tr.selected").removeClass("selected"),c&&c.selected_rows){c.selected_rows=[];var d=a.Event("qlist_select_rows");b.trigger("qlist_select_rows",d)}}function x(b){Oa.column_filters.value=b,o.put(Oa.ck_name.filter,b.length?JSON.stringify(b):"");var c=a.Event("filter_applied");La.trigger(c,[b]),Oa.paging.server_side&&!Oa.column_filters.force_client_side?a.isFunction(Oa.column_filters.server_side_reload)?Oa.column_filters.server_side_reload():window.location.reload():a(La).qlist()}function y(a,b){function c(a,b){var c,d,e,f,g,h,i,j=!1,k=Array.isArray(b)?b:[b];for(e=0;e<k.length;e++){for(d=k[e],c=Object.keys(d),i=!0,f=0;f<c.length;f++)if(g=c[f],h=d[g],a[g]!==h){i=!1;break}if(i){j=!0;break}}return j}var d,e,f=[],g=a.source,h=g.length;for(d=0;d<h;d++)e=g[d],c(e,b)&&(e[Ta]=!0,f.push(d));return f}function z(){if(Oa.column_filters.value)return Oa.column_filters.value;var b=l("filter"),c=m(o.get(Oa.ck_name.filter)||"[]")||[];return"undefined"!=typeof b&&"undefined"!=typeof(b=m(b))&&(c=r(c,a.extend({logic:{},value:[]},b),!0),o.put(Oa.ck_name.filter,JSON.stringify(c))),c}function A(a){Oa.column_filters.enabled&&B(a)}function B(b){var c=new jQuery.Deferred;"undefined"==typeof filterLoadResource?c=a.addScript({url:"/"+fweb.CONFIG_GUI_NO+"/module_js/filter.js"}):c.resolve().promise(),c.done(function(){filterLoadResource(),a(b).filterConsole({columns:S(),filters:z(),action:s,targetSelector:"th span.filter"})})}function C(a){return Oa.source[a.getAttribute("data-source-index")]}function D(){var a=La.data("qlist_state"),b=a.selected_rows;return b||(b=a.selected_rows=[]),b}function E(a){var b=La.data("qlist_state");b&&(b.selected_rows=a)}function F(b){function c(b){return"lang_key"in b&&null!==b.lang_key?a.getInfo(b.lang_key):b.selector}Oa.columns.sort(function(d,e){var f=a.inArray(d.selector,b),g=a.inArray(e.selector,b);return f!==g?f<0?1:g<0?-1:f-g:a.sortCompareText(c(d),c(e))})}function G(b,c,d,e){var f=Oa.format_fn[c]||Oa.format_fn["*"]||d[c];return a.isFunction(f)&&(f=f(b,Oa.column_map[c]||c,d,Oa.$scope,e)),"undefined"==typeof f?d[c]:f}function H(b,c){var d=!1,e=G(null,b.id,c),f=Oa.column_map[b.id];if(null==f)return!0;if("datetime"===f.fld_type&&b.logic.RANGE&&b.value&&2===b.value.length){var g=Date.parse(b.value[0].replace(/-/g,"/"))/1e3,h=Date.parse(b.value[1].replace(/-/g,"/"))/1e3,i=c[b.id];return g<=i&&(!b.value[1]||i<=h)}var j=!!f.value;return Array.isArray(e)?a(e).each(function(a,c){return d=I(c,b,j)>=0,!d}):d=I(e,b,j)>=0,d}function I(b,c,d){var e=Array.isArray(c.value)?c.value:[c.value];if(c.logic.RANGE&&2===e.length)return"int"===Oa.column_map[c.id].fld_type?""===b?-1:(b=+fb.exec(b)[0],c.logic.RANGE_EXCLUSIVE?(b>+e[0]&&(""===e[1]||b<+e[1]))-1:(b>=+e[0]&&(""===e[1]||b<=+e[1]))-1):c.logic.RANGE_EXCLUSIVE?b>e[0]&&(""===e[1]||b<e[1])?1:-1:b>=e[0]&&(""===e[1]||b<=e[1])?1:-1;var f=!d&&"string"===a.type(b);f&&(b=b.toLowerCase());for(var g=e.length;g--;){var h=e[g];if(f){if(fweb.util.patterns.htmlStringContains(b,h.toString().toLowerCase()))return g}else{if(a.isPlainObject(b))for(var i in b)if(b.hasOwnProperty(i)){if("string"===a.type(b[i])&&b[i].toLowerCase().indexOf(h.toString().toLowerCase())!==-1)return g;if(a.isPlainObject(b[i])&&I(b[i],c,d)>=0)return g}if(String(b)===h)return g}}return-1}function J(a,b){for(var c,d=b||z(),e=0;c=d[e];e++){var f=Oa.filter_fn[c.id]||Oa.filter_fn["*"]||H,g=f(c,a);if("0"===c.logic.NOT&&fweb.log("flt.logic.NOT has invalid value '0', please check."),g===(!!c.logic.NOT||!1))return!1}}function K(a,b){for(var c,d=0;c=this[d];d++){var e=G(null,c,a),f=G(null,c,b);if(e!==f)return e>f?1:-1}return 0}function L(b,c,d){var e,f,g=Oa.source,h=g[b];if(b>c){do f=g[--b].q_origin_key;while(!f)}else do e=g[++b].q_origin_key;while(!e);if(h.q_path&&h.q_name){var i="/api/v2/cmdb/"+h.q_path+"/"+h.q_name+"/"+h.q_origin_key+"?action=move&"+(f?"after="+f:"before="+e);a.ajax({url:i,method:"PUT"}).done(function(){Oa.reordering.refresh_on_drop?a(La).qlist("reload",!1):a.isFunction(Oa.callbacks.post_reorder)&&Oa.callbacks.post_reorder.call(La[0],k),Notify.post(a.getInfo("changes_saved"),"success"),a(Oa.reordering.items).each(function(b){var c=b%2;a(this).toggleClass("odd",!!c)})}).error(function(b){Notify.post(a.getInfo(b.status),"error")})}}function M(){var b=Oa.sort_categories_fn,c=a.getInfo("implicit"),d=Oa.categories.length?Oa.categories_map:{},e=(Object.keys||function(b){return a.map(b,function(a,b){return b})})(d);e.sort(function(a,d){return a===c?1:d===c?-1:b(a,d)});var f=Oa.categories_map={};a(e).each(function(a,b){f[b]=d[b]})}function N(b){var c=Oa.sort_sections_fn;a.isFunction(c)&&b.sort(function(a,b){return a.implicit?1:b.implicit?-1:c.call(Oa.sections,a,b)})}function O(b){var c=null;return a.each(Oa.categories_map||{},function(a,d){return b<d.length?(c=a,!1):void(b-=d.length)}),c}function P(a){function b(a,b){for(var c=[],d=0;d<a.length;d++){var e=G(null,a[d],b);void 0!==e&&c.push(e)}return c}return b(Oa.sections,a).join(" - ")}function Q(a,b){for(var c=0;c<a.length;++c){var d=a[c],e=G(null,d,b);if(void 0!==e)return!0}return!1}function R(b){function c(b,c){for(var d in i)if(i.hasOwnProperty(d)){if(!b&&a.inArray(c,i[d])>=0)continue;if(0!==g.call(h,j[d],c))continue;b?i[d].push(c):i[d].unshift(c)}b&&!i[b]&&(j[b]=c,i[b]=[c])}function d(a){return a.join(" - ")}var e,f,g=Oa.sort_compare,h=Oa.categories,i=Oa.categories_map={},j={};for(e=0,f;f=b[e];e++){var k=[];if("category"in f&&"string"==typeof f.category)c(f.category,f);else{for(var l=0;l<h.length;l++)k.push(G(null,h[l],f));c(d(k),f)}}for(e=b.length-2;e>=0;e--)c(null,b[e]);a.isFunction(Oa.sort_categories_fn)&&M(),b.length=0,a.each(Oa.categories_map,function(c,d){Oa.sections.length&&N(d),a.merge(b,d)})}function S(){function b(a){return"number"==typeof a.fld_type?a.fld_type:a.values?FIELD_TYPE.ENUM:FIELD_TYPE.STRING}var c={int:FIELD_TYPE.INTEGER,date:FIELD_TYPE.DATE,datetime:FIELD_TYPE.DATE_TIME,ip:FIELD_TYPE.IP_HOST},d=a.map(Oa.chosen_columns,function(d){var e=Oa.column_map[d];if(null==e)return setFilterDetails({key:d});var f={key:d,label:"lang_key"in e&&null!==e.lang_key?a.getInfo(e.lang_key):sa(e.icon),selection:e.values};return e.filter&&(f.validate=e.filter.validate,f.display=e.filter.display,f.support=e.filter.support,f.help=e.filter.help),setFilterDetails(f,c[e.fld_type]||b(e),e.fld_max||DISPLAY_FILTER_TYPE_SELECT_MULTIPLE),f});return filter_settings[Oa.prefix]=d,d}function T(b,c){var d=a(this);null==b&&(b=d.find(".current-page").val()),null==c&&(c=d.find(".total-pages").text()),b=+b,c=+c;var e=d.find(".first-page"),f=d.find(".previous-page"),g=d.find(".next-page"),h=d.find(".last-page"),i=b>1,j=b<c;e.prop("disabled",!i),f.prop("disabled",!i),g.prop("disabled",!j),h.prop("disabled",!j),Oa.paging.last_page_button||(h.hide(),d.find(".show-more-less").toggle(j)),d.find(".current-page").val(c?b||1:0).prop({disabled:c<=0,max:c})}function U(b,c,d){ea(b,d,c).done(function(){fweb.util.structure.extendAdminTimeout(),a.isFunction(Oa.callbacks.post_paging)&&Oa.callbacks.post_paging.call(La[0],La[0]);var b=La,c=b.find("thead > tr.heading");h("postload",La,{config:Oa,state:Ua,qlist:b,head_row:c,fn:Va})})}function V(b,c,d,e,f){return b=Number(b),b<1||b>c&&!Oa.paging._unknown_pagecount?void(f&&f.remove()):(gb=b,c=Number(c),this.find(".current-page").enable(c>0).val(b<=c?b:c),T.call(this,b,c),a.isFunction(Oa.callbacks.pre_paging)&&Oa.callbacks.pre_paging.call(La[0]),void e(b))}function W(a,b,c){var d,e,f;return f=function(){return!0},d=b.column_filters.enabled?b.column_filters.filter_fn:f,e=i("get_filter_fn",a,{config:b,state:c,fn:Va},d),e===f?null:e}function X(a){var b=a._cache_id||(a._cache_id="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"===a?b:3&b|8;return c.toString(16)}));return Ua.cache.source[b]||(Ua.cache.source[b]={})}function Y(b,c,d,e){var f=X(b),g=f.filtered;return void 0!==g?g:(a.isPlainObject(b.expansion)?g=X(b.expansion).filtered:(g=!1,!g&&a.isFunction(c)&&(g=c(b,e)===!1),!g&&a.isFunction(d)&&(g=d(b,e)===!1)),f.filtered=g)}function Z(a,b){if(void 0!==Ua.cache.filtered_lines)return Ua.cache.filtered_lines;var c=Oa.filter;if(!a&&!c)return Ua.cache.filtered_lines=Oa.source.length;for(var d,e=0,f=b||z(),g=0;d=Oa.source[g];g++)Y(d,c,a,f)||e++;return Ua.cache.filtered_lines=e}function $(a){return Ua.display_master.length>a?Ua.display_master[a]:a}function _(a,b,c,d){for(var e,f=0,g=0;e=Oa.source[$(g)];g++)if(!Y(e,b,c,d)){if(f===a)return g;f++}return f}function aa(a,b){function c(b,c){var d=(b-1)*f;a.empty(),(c||U)(a,d,f),Fa(e)}var d=b,e=a.parent(),f=Oa.paging.page_lines;if(Oa.paging.total_lines>0&&Oa.paging.total_lines===Oa.paging.page_lines)return ea(a,f,void 0,b);var g=Oa.source.length;return Ra||(g=Z(W(d,Oa,Ua))),da(a,g,f,c)}function ba(){return"undefined"==typeof Oa.paging.completed||Oa.paging.completed()}function ca(b,c){function d(f,g){var h=!1;clearTimeout(Oa.timer),a(b).data("page_cur")!==f&&(a(b).data("page_cur",f),Oa.paging.hybrid_server_paging||(Oa.source.length=0),h=!0),Oa.paging.fetch(f,function(a,i){h&&(b.empty(),b.scrollParent().scrollTop(0));var j;for(null==i&&(i=Oa.source.length),j=0;a.source[j];j++)Oa.source[i+j]=a.source[j];Oa.paging.total_lines=a.total_lines;var k=a.total_lines,l=Math.ceil(k/e);c.find(".total-pages").text(l),c.find(".total-lines-total").text(k),T.call(c,f,l);var m=g||U;Oa.paging.hybrid_server_paging?m(b,(f-1)*e,e):m(b,i,j),La.trigger("qlist.update"),ba()||(Oa.timer=setTimeout(function(){d(f,g)},Oa.paging.timeout))},{page_num:f,source_length:Oa.source.length,lines_per_page:e})}var e=Oa.paging.page_lines||Oa.source.length;ba()||(Oa.timer=setTimeout(d,Oa.paging.timeout));var f=Oa.paging.total_lines;return da(b,f,e,d)}function da(b,c,d,e){function f(a){"show_less"===a&&(d=c)}function g(b){function c(a){for(;a&&!a.scrollTop;)a=a.offsetParent;return a?a.scrollTop:0}b.find(".loading-container").remove();var d=c(b[0]);return a('<div class="loading-container flex-centered"><f-icon class="qlist-loading-icon fa-loading icon-xxxl" ng-show="loading"></f-icon></div>').css({top:d,bottom:-d}).appendTo(b)}Oa.paging.mode&&f(Oa.paging.mode),Sa>=0&&(gb=Math.ceil((Sa+1)/d)||1);var h=Math.ceil(c/d),i=La.find(".qlist-footer");i.length?i.empty():(i=a('<div class="qlist-footer"></div>'),La.append(i)),a('<button type="button" class="first-page"><f-icon class="fa-angle-double-left"></f-icon></button>').attr("title",a.getInfo("page_first")).on("click",function(){var a=Number(i.find(".total-pages").text()),c=g(b);V.call(i,1,a,d,e,c)}).appendTo(i),a('<button type="button" class="previous-page"><f-icon class="fa-angle-left"></f-icon></button>').attr("title",a.getInfo("page_prev")).on("click",function(){var a=Number(i.find(".total-pages").text()),c=Number(i.find(".current-page").val()),f=g(b);V.call(i,c-1,a,d,e,f)}).appendTo(i);var j,k=a.debounce(500,function(c,f){if(c||gb!==parseInt(this.value)){gb=null,a(b).data("page_cur",null);var g=Number(i.find(".total-pages").text());V.call(i,this.value,g,d,e,f)}});a('<input type="number" class="bare current-page" />').prop({min:1,max:h,value:c?gb:0}).on("change",function(a,c){c||gb!==parseInt(this.value)?(b.find(".loading-container").remove(),j=g(b)):b.find(".loading-container").remove(),k.call(this,c,j)}).on("keypress",function(b){if(13===b.keyCode)return a(this).change(),!1}).appendTo(i);var l=c<=d&&ba(),m=!Oa.paging.last_page_button&&!l;Oa.paging._unknown_pagecount=m,m||i.append('<span class="of-pages">/</span>');var n=a('<span class="total-pages"></span>').text(h).appendTo(i);n.toggle(!m),a('<button type="button" class="next-page"><f-icon class="fa-angle-right"></f-icon></button>').attr("title",a.getInfo("page_next")).on("click",function(){var a=Number(i.find(".total-pages").text()),c=Number(i.find(".current-page").val()),f=g(b);V.call(i,c+1,a,d,e,f)}).appendTo(i),Oa.paging.last_page_button&&a('<button type="button" class="last-page"><f-icon class="fa-angle-double-right"></f-icon></button>').attr("title",a.getInfo("page_last")).on("click",function(){var a=Number(i.find(".total-pages").text()),c=g(b);V.call(i,a,a,d,e,c)}).appendTo(i);var o=a('<span class="total-lines">['+a.getInfo("total")+': <span class="total-lines-total">'+c+"</span>]</span>").appendTo(i);if(o.toggle(!m),(h>1||Oa.paging.mode)&&Oa.paging.show_all_button){Oa.paging.mode=Oa.paging.mode||"show_more";var p=function(){var a=Oa.paging.mode,b="show_more";a===b&&(i.find(".current-page").val(1),b="show_less"),Oa.paging.mode=b};a('<button class="bare show-more-less"></button>').text(a.getInfo(Oa.paging.mode)).on("click",function(){return p(),a(La).qlist("reload",!1),!1}).appendTo(i)}return T.call(i,gb,h),ea(b,d,(gb-1)*d)}function ea(b,c,e,f){function g(b,c,d,e){e=a.extend(e||{},{separator:" - ",wrap_selector:!1});for(var f=Oa.options.atomic_render?[]:a(),g=0;g<b.length;g++){var h=H(d,e.wrap_selector?{selector:b[g]}:b[g],c);void 0!==h&&(Oa.options.atomic_render?f.push(h):("string"===a.type(h&&h.valueOf())&&(h=a.parseHTML(h.valueOf())),f=f.add(h)))}return e.separator!==!1&&(Oa.options.atomic_render?f=f.join(e.separator):f.not(":last").after(e.separator)),f}function j(){if(r){var b=a("label",r);a.inArray("#",Oa.chosen_columns)>=0?a(b).append(" ("+(t-u+1)+" - "+t+")"):a(b).append(" ("+u+")")}}function k(){if(s){var b=a("label",s);a.inArray("#",Oa.chosen_columns)>=0?a(b).append(" ("+(v+1)+" - "+((e||0)+t)+")"):a(b).append(" ("+((e||0)+t-v)+")"),s=void 0}}var l=e||0;if(!e&&localStorage){var m=+localStorage.getItem(Oa.prefix+"/current_page");m&&a.isNumeric(c)&&(localStorage.setItem(Oa.prefix+"/current_page",""),l=c*(m-1),T.call(b,m))}var p,q,r,s,t=0,u=0,v=0,w=!0,x=Oa.sort_compare,y=Oa.filter,A=z(),B=(o.get(Oa.ck_name.category)||"").split(","),C=Oa.chosen_columns.length,D=a.Deferred(),E=f||a(b).closest("div.qlist");Sa>=0&&(B.push(O(Sa)),B.push(P(Oa.source[Sa]))),!Oa.sort||Oa.sort.fast_update===!1||Oa.paging.enabled||null!==Oa.category.q_type&&null!=Oa.column_map.category?Ua.fast_sort=void 0:(Ua.fast_sort=[],Ua.fast_sort_target=b);var F=W(E,Oa,Ua),H=i("get_formatted_cell",E,{config:Oa,state:Ua,fn:Va},G),I=i("get_formatted_category_header",E,{config:Oa,state:Ua},function(a){return a});l>0&&!Ra&&(l=_(l,y,F,A));var J,K,L,M,N,R=l,S=function(f){function i(c,e,f,g){var h=$(e),j=T?null:{},k=j||T;p=document.createElement("tr"),Oa.options.focusable_rows&&("number"==typeof Oa.options.focusable_rows?p.setAttribute("tabindex",Oa.options.focusable_rows):p.setAttribute("tabindex",FOCUSABLE_ROW_TABINDEX));var n="qlist_row";g&&(n+=" hidden"),Ra&&c[Ta]&&(n+=" located_row"),b.get(0).appendChild(p),p.setAttribute("data-source-index",h),Ua.fast_sort&&(Ua.fast_sort[h]=a(p)),a(p).data("regenerate",function(b,c,d){var f,g,j=a(b).hasClass("hidden"),k=i(c,e,h,j);return d&&(f=a(d).closest("td").attr("class"),g=a(k).find("."+f)),b.replaceWith(k),{row:k,context:g}}),a.each(Oa.row_attr,function(a,b){var d=c[b.selector];null!=d&&p.setAttribute(b.name,"__index__"===b.selector?h:d)}),p.setAttribute("class",n),Oa.row_gen.call(a(p),l+f,c);var o,q="",r=document.createElement("td");if(d()){var s,t,u,v,w=a("<tbody></tbody>"),x=a('<td><table class="table"></table></td>');Oa.chosen_columns.forEach(function(b){"q_ref"!==b&&(u=a.getInfo(Oa.column_map[b].lang_key),s=a('<tr data-source-index="'+h+'"></tr>'),s.append('<td class="key">'+u+"</td>"),t=a('<td class="value '+b+" "+e+'"></td>').attr("selector",b).appendTo(s),w.append(s))}),x.children("table").append(w),a(p).append(x),Oa.chosen_columns.forEach(function(b){t=d()?a(p).find('td[selector="'+b+'"]'):a(p).find("td.value."+b+"."+e),v=H(t,b,c),t.append(v)})}else{for(var y,z=0;y=Oa.chosen_columns[z];z++)if(Oa.options.atomic_render){r.setAttribute("class",y),r.setAttribute("selector",y),r.setAttribute("atomicSourceIndex",e),o=H(a(r),y,c);var A='<td class="'+r.getAttribute("class")+'">';q+=A+o+"</td>"}else{if(L=a('<td class="'+y+'"/>').attr("selector",y).appendTo(p),o=H(L,y,c),L.append(o&&o.valueOf()),Oa.after_format_fn&&y in Oa.after_format_fn){var B=k[y]=k[y]||[];B.push(L[0])}Oa.custom_cols&&Oa.custom_cols.indexOf(y)!==-1&&Oa.col_gen(L,c,y,f,p)}Oa.options.atomic_render&&(p.innerHTML=q)}return m(j),a(p)}function m(a){if(null!==a)for(var b in a){var c=Oa.after_format_fn[b];c&&c(a[b])}}function o(a){return function(){S(a)}}var z,G,T=null,U=Date.now(),V=0;for(h("load_row_frag",E,{config:Oa,state:Ua,tbody:b,fn:Va}),T={};q=Oa.source[z=$(R)];R++)if(Ra||!Y(q,y,F,A)){if(J=O(z),J&&(R===l||J!==O(f))){Ua.fast_sort=void 0;var W=b.parent();R!==l?(Oa.options.add_section_num&&k(),Oa.options.add_category_num&&j(),u=0,r=a("<tbody/>").appendTo(W)):r=b,b=a("<tbody/>").appendTo(W),r.addClass("category").data("category",J),K=a('<tr class="qlist_category"/>').appendTo(r),L=a('<td class="left" colspan="'+C+'"/>').appendTo(K),G=void 0!==typeof Oa.options.collapsible_categories[J]&&Oa.options.collapsible_categories[J]||Oa.options.collapsible_categories["*"];var X=!G||a.inArray(J,B)>=0,Z=I(J,z);L.append('<label class="visual-toggle-label '+(G?'collapsible"><button type="button" class="compact-visual-toggle'+(X?" active":"")+'"></button> ':'">')+Z+"</label>"),b.toggleClass("hidden",!X),w=!0}if(!u||0!==x.call(Oa.sections,q,Oa.source[f])){Ua.fast_sort=void 0,Oa.options.add_section_num&&k();var _=P(q),aa=Q(Oa.section_widgets,q);if(_){K=a('<tr class="qlist_section" />').data("section",_).data("sectionFirstIndex",R);for(var ca=0;ca<Oa.section_attr.length;ca++){var da=Oa.section_attr[ca];K.attr(da.name,q[da.selector]||"")}aa?(M=a('<tr class="qlist_section_widget unselectable" />'),N=a('<td class="left" colspan="'+C+'"><div class="qlist_widget_content"></div></td>'),N.appendTo(M),M.attr("section",_),K.add(M).appendTo(b)):K.appendTo(b),Oa.options.editable_sections&&(K.attr("mkey",q[Oa.sections[0]]),K.attr("can_delete",0)),L=a('<td class="left" colspan="'+C+'"/>').appendTo(K),G=void 0!==typeof Oa.options.collapsible_sections[_]&&Oa.options.collapsible_sections[J]||Oa.options.collapsible_sections["*"],w=!G||a.inArray(_,B)>=0,M&&M.toggleClass("hidden",!w);var ea=g(Oa.sections,q,L),fa=Oa.section_row_gen;if("function"!=typeof fa){var ga='<label class="{{ sec_td_class }}">{{ sec_td_label_html }}</label>',ha="";G&&(ha='<button type="button" class="{{ btn_class }}"></button>',ha=n(ha,{btn_class:"compact-visual-toggle "+(w?"active":"")})),ga=n(ga,{sec_td_class:G?"visual-toggle-label collapsible":"visual-toggle-label",sec_td_label_html:ha}),L.append(a(ga).append(ea))}else w=fa.call(L,q,G,w,ea,C);s=K,v=(e||0)+t}}if(p=i(q,R,t,!w),a(p).hasClass("qlist_expansion_child")||(u++,t++),c&&t>=c)break;if(Date.now()-U>MAX_FRAG_TIME)return setTimeout(o(z),0),R++,void m(T);f=z}else V+=1;m(T),T=null,Oa.options.add_category_num&&j(),Oa.options.add_section_num&&k(),setTimeout(function(){Oa.source.length<=V&&ba()&&(Ua.fast_sort=void 0,pa(a("<tr/>").appendTo(b),Oa.empty_msg)),Oa._gen_row_export=i,D.resolve()},0)};return S(),D.promise()}function fa(b,c){var d=a("#"+Oa.prefix+"-qlist"),e=d.find("tbody").last();e.find("tr.empty_row").remove();var f=e.children("TR").length;c>=0&&c<=f&&(f=c);var g=Oa._gen_row_export(b,f,f);g.jquery||(g=a(g));var h=e.find("tr.qlist_row").eq(f).data("source-index",f);return g.insertBefore(h),g}function ga(a){Oa._api&&Oa._api.select_rows&&Oa._api.select_rows([a])}function ha(a){Oa._api&&Oa._api.select_rows&&Oa._api.select_rows(a)}function ia(){var a=La.data("qlist_state");return a._rows_ready.then(function(){return Oa._api.get_selected_entries()})}function ja(){return(La.data("qlist_state").cache||{}).filtered_lines}function ka(){var a=La.data("qlist_state").cache||{},b=Oa.source;return a.filtered_lines?a.filtered_lines===b.length?b:b.filter(function(b){return!a.source[b._cache_id].filtered}):[]}function la(){Oa.prefix&&a(window).off(Pa+Oa.prefix)}function ma(b,c){var d=a.Deferred();return a.when(Oa.source).done(function(e){var f=e;if(Oa.options.inline||(f=a.extend([],e),Oa.source=f),Oa.categories.length?R(f):Oa.sections.length&&N(f),h("source_load_complete",La,{config:Oa,state:Ua,tbody:b,fn:Va}),Ra){var g=y(Oa,Ra);0===g.length?(Notify.post(a.getInfo("Could not locate entry in list"),"warning"),Sa=-1):Sa=g[0]}if(Oa.paging.enabled){var i=Oa.paging.server_side?ca(b,c):aa(b,c);i.then(function(){d.resolve()},d.reject)}else ea(b).then(function(){d.resolve()},d.reject)}),d.promise()}function na(){var b=a(La),c=null,e=null,f=null,g="tr.qlist_row:not(.unselectable)",h="tr.qlist_section",i="tr.qlist_category",j=null,k=g,l=g+","+h+","+i,m=function(){return b.find(g)},n=function(){return b.find("tr.qlist_row.selected")},o=function(){D().forEach(function(b){a(b).removeClass("selected")}),E([])},p=function(){e&&(e.removeClass("selected"),e=null),f&&(f=null)},q=function(b,f){var g=a(f);d()&&!g.hasClass("qlist_row")&&(g=g.parents("tr"),f=g[0]);var i,k,l,q,r,s,t,u,v,w=b.shiftKey,x=b.ctrlKey||b.metaKey;if(Oa.options.click_ignore&&Oa.options.click_ignore(b))return!1;if(Oa.options.inline&&g.hasClass("editing"))return!1;if(Oa.options.disable_selection)return!1;if(a(":focusable").not(f).blur(),p(),g.is(h))e=g,o(),g.addClass("selected"),c=null;else if(w){if(k=n(),!k.length)return!1;q=k.get(0),r=k.get(k.length-1),l=m(),s=0,l.each(function(){this===f&&(t=s),this===q&&(u=s),this===r&&(v=s),s++}),t>=v?(q="down"===j||x?q:r,r=f,j="down"):t<=u?(r="up"===j||x?r:q,q=f,j="up"):"down"===j?r=f:q=f,s=-1,l.each(function(){var b=!1;s<0?this===q&&(b=!0,s=0):0===s&&(b=!0,this===r&&(s=1)),a(this).toggleClass("selected",b)}),c=f,E(n().toArray()),fweb.util.dom.clearTextSelection()}else x?g.hasClass("selected")?(g.removeClass("selected"),i=D(),i.splice(i.indexOf(f),1)):(g.addClass("selected"),c=f,E(n().toArray())):(o(),g.addClass("selected"),c=f,E([f]));return!0},r=function(b,g){var h,i,j,k=c?C(c):null,l=D();g&&(h=d()?a(g.target).next("td"):a(g.target).closest("td"),h.closest("tr").is(".qlist_section")||(i=h.attr("selector"),k&&(j=k[i]))),a(La).trigger(b,{event:g,$section_row:e,$category_row:f,last_selected:k,rows:l,entries:l.map(C),$td:h,column_selector:i,column_value:j})};Oa.options.editable_sections&&(k+=","+h);var s=function(b){b.preventDefault();var d=a(b.target).closest(l);if(d.length){var g=d[0];p(),D().indexOf(g)<0?(o(),d.is(h)?(e=d,c=null):d.is(i)?(f=d,c=null):(E([g]),c=g),(!e&&!f||e&&Oa.options.editable_sections)&&d.addClass("selected"),r("qlist_select_rows",b)):c=g,r("qlist_contextmenu",b)}return!1};Oa.options.mobile_style||delete Hammer.defaults.cssProps.userSelect;var t=b.data("Hammer.Manager");t||(t=new Hammer.Manager(b[0]),t.add(new Hammer.Tap),t.add(new Hammer.Press),t.add(new Hammer.Pan),b.data("Hammer.Manager",t));var u=function(b){return"TD"===b.target.nodeName&&Oa.options.editable_sections?a(b.target).parent():a(b.target).closest("tr.qlist_row:not(.unselectable)")};t.off("tap").on("tap",function(a){var b=u(a);return 1===b.length&&q(a.srcEvent,b[0])&&r("qlist_select_rows",a),!1}),t.off("pressup").on("pressup",function(a){var b=u(a);return 1===b.length&&q(a.srcEvent,b[0])&&(Oa.options.is_touch?s(a):r("qlist_select_rows",a)),!1}),b.off("dblclick").on("dblclick",k,function(a){q(a,this)&&r("qlist_dblclick_row",a)});var v=null;b.off("keydown.qlist").on("keydown.qlist",k,function(b){function c(b){var c=a(D());if(c.length){var d=b>0?c.last().next(k):c.first().prev(k);return d.length&&d}return null}Oa.options.focusable_rows&&(b.which===a.ui.keyCode.UP?v=c(-1):b.which===a.ui.keyCode.DOWN&&(v=c(1)),v&&b.preventDefault())}),b.off("keyup.qlist").on("keyup.qlist",k,function(a){v&&(v.length&&q(a,v[0])&&(v.focus(),r("qlist_select_rows",a)),v=null)}),Oa._api.select_rows=function(b){o(),a(b).addClass("selected"),c=b[b.length-1],E(b),r("qlist_select_rows")},Oa._api.get_selected_entries=function(){var a=D();return a.map(C)},b.find("tbody").off("contextmenu").on("contextmenu",function(a){t.off("pressup"),s(a)})}function oa(a,b,c){na()}function pa(b,c,d){"undefined"==typeof d&&(d=""),a(b).addClass("empty_row nodrag qlist_row qlist_skip_row unselectable").attr("can_edit","0").attr("can_delete","0");var e=a('<td class="'+d+'" />').appendTo(b),f=a("thead tr:first",b.closest("table"))[0];f&&(e.attr("colspan",f.cells.length),e.text(c))}function qa(b,c){var d,e="",f="",g=z();if(!Ra)for(var h,i=0;h=g[i];++i)if(h.id===c){d=h.logic||{},d.NOT&&(f+="NOT "),f+=a.getInfo("filter_contains")+": ",f+=Array.isArray(h.value)?h.value.join(d.RANGE?" - ":" OR "):h.value,e="filter-enabled";break}return a('<span class="filter"></span>').html('<f-icon class="fa-filter '+e+'"></f-icon>').attr("title",f)}function ra(a,b){var c=b.element.closest("th");c.data("preset")&&(c.data("preset").width=c.width()),Fa(c.closest("table"))}function sa(a){return'<f-icon class="'+a+'"></f-icon>'}function ta(b,c){var d=a("<div/>").appendTo(b);if("selector"in c){var e,f=Oa.column_filters;f.enabled&&(void 0===c.filter||c.filter)&&a.inArray(c.selector,f.exempts)===-1&&(e=qa(b,c.selector),d.append(e));var g="lang_key"in c?c.lang_key:"field_"+c.selector;c.icon&&d.append(sa(c.icon)),e=null===g?"":a.getInfo(g),d.append(e)}Oa.options.resizable_columns&&Oa.options.inline&&d.resizable({handles:"e",alsoResize:b,start:function(){var a=b.closest("table.qlist");a.data("adjust.locker",ra)},stop:ra,minWidth:d.width()-1,zIndex:1})}function ua(a,b){return arguments.length>1?void a.data("adjustLock",!!b):a.data("adjustLock")||!1}function va(a,b){Oa.options.inline||a.trigger("qlist_config_menu",{event:b,options:{columns:Oa.columns,chosen_columns:Oa.chosen_columns}})}function wa(b,c){var d=b.find(".qlist-fixed-head"),e=a("<table></table>"),f=c.find("thead").clone(!0);return f.find("*").addBack().off(),d.append(e.append(f))}function xa(b,c,d){Oa.options.resizable_columns&&(Fa(c),d.find("th").each(function(){a(this).find("div:first").resizable({alsoResize:this,handles:"e",start:function(){ua(b,!0)},stop:function(){Da(d,c),Da(c,d),ua(b,!1)},minWidth:a(this).find("div:first").width(),zIndex:1})}))}function ya(b,c,d){var e="th:not([fixed])";d.find(e).addClass("sortable"),d.sortable({items:"th:not([fixed])",helper:"clone",start:function(a,b){b.item.data("start-pos",b.item.index())},update:function(b,c){var d=Oa.chosen_columns,e=Number(c.item.data("start-pos")),f=c.item.index(),g=c.item.data("selector"),h=d.splice(e,1);d.splice(f,0,h.pop());var i=a.Event("column_reorder");La.trigger(i,[g,d]),o.put(Oa.ck_name.column,d.join(",")),a(La).qlist("reload")},distance:15}).disableSelection()}function za(a,b,c){c.off("contextmenu").on("contextmenu",function(b){return b.preventDefault(),va(a,b),!1})}function Aa(b,c,d){d.off("click.fixedclick").on("click.fixedclick","th",function(){var b="th:nth-child("+(a(this).index()+1)+")";c.find(b).click()})}function Ba(a,b){var c=a.find(".qlist-fixed-head table");if(c.length<1){var d=wa(a,b);c=d.find("table"),A(c),xa(a,b,c),za(a,b,c),ya(a,b,c),Aa(a,b,c);var e=a.find(".qlist-table");e.off("scroll.qlist-fixed-header").on("scroll.qlist-fixed-header",function(){c.css("margin-left",0-e[0].scrollLeft+"px")})}return c}function Ca(a){var b=a.find(".qlist-table"),c=b.find("tr.qlist_row.located_row");if(c.length){var d=b.scrollTop()+c.position().top;d-=b.height()/2,d+=c.height()/2,b.scrollTop(d)}}function Da(b,c){if(!d()){var e=b.find("th"),f=c.find("th"),g=Math.min(e.length,f.length);c.css("max-width",b.width());for(var h=0;h<g;++h)a(f[h]).children("div:first").width(window.getComputedStyle(a(e[h]).children("div:first")[0]).width)}}function Ea(a,b,c){Da(b,c)}function Fa(b){var c=a(b);if(!c.is(".qlist_fixed_column_header")){var d=c.closest("div.qlist");ua(d)||d.length<1||(Oa.options.inline||Oa.options.mobile_style||Ea(d,c,Ba(d,c)),Ca(d))}}function Ga(){a(".qlist-table > table",La).each(function(a,b){Fa(b)})}function Ha(b){if(Oa.reordering.enable&&!d()){var c=b.children("tbody:not(.category)").addClass("sortable");Fa(b);var e,f=function(a){var b=a.item.data("dependant");b&&b.addClass("qlist_expansion_child").toggleClass("hidden",!e).insertAfter(a.item)};c.find(Oa.reordering.drag).addClass("sortable");var g={items:">"+Oa.reordering.items,handle:Oa.reordering.drag,helper:"clone",start:function(b,c){var d=c.item.index();if(c.item.data("start-pos",d),c.item.hasClass("qlist_expansion_child"))c.item.data("parent",a(c.placeholder).prevAll(":not(.qlist_expansion_child):first"));else{var f=a(c.placeholder).nextUntil(":not(.qlist_expansion_child)");e=f.is(":not(.hidden)"),c.item.data("dependant",f.removeClass("qlist_expansion_child").addClass("hidden"))}for(var g,h=a("tr.qlist_row:visible:first",c.item.parent())[0],i=0;g=c.helper[0].cells[i];i++)a(g).width(a(h.cells[i]).width());
},stop:function(a,b){f(b)},update:function(b,c){function d(a,b){do a=b?a.prev():a.next();while(a[0]&&void 0===a.data("sourceIndex"));return a}var e,g,h,i,j=c.item.data("sourceIndex"),k=c.item.data("start-pos"),l=c.item.index(),m=(c.item.data("dependant")||[]).length;if(null!=c.item.prev().data("sourceIndex")?(i=c.item.prev(),e=j>i.data("sourceIndex")?i.data("sourceIndex")+1:i.data("sourceIndex")-m):(i=c.item.next(),e=j>i.data("sourceIndex")?i.data("sourceIndex"):i.data("sourceIndex")-1-m,e<0&&(e=0)),c.item.hasClass("qlist_expansion_child")){var n=c.item.prevAll(":not(.qlist_expansion_child):first");if(n[0]!==c.item.data("parent")[0])return void c.item.parent().sortable("cancel")}else{var o=c.item.nextUntil(":not(.qlist_expansion_child)");if(o[0]){if(l+=o.length,k===l)return c.item.parent().sortable("cancel"),void f(c);c.item.insertAfter(o[o.length-1])}}if(k<l)for(h=c.item,h=d(h,1);h[0]&&h.index()>=k;h=d(h,1))h.attr("data-source-index",h.data("sourceIndex")-(1+m));else{for(h=c.item,g=0;g<m;g++)h=h.next();for(h=d(h);h[0]&&h.index()<k+1+m;h=d(h))h.attr("data-source-index",h.data("sourceIndex")+(1+m))}for(c.item.attr("data-source-index",e),g=0;g<m;g++)h=c.item.data("dependant")[g],a(h).attr("data-source-index",e+g);for(var p=Oa.source.splice(j,1+m);p.length;)Oa.source.splice(e,0,p.pop());Oa.reordering.onDrop.call(c.item,e,j,i.data("sourceIndex"))}};c.on("mouseenter","tr.qlist_row",Oa.reordering.drag,function(){a(this).parents("tbody").sortable(g)})}}function Ia(){a(La).qlist("reload")}var Ja=a(this),Ka=Ja[0];if(Ka&&("object"==typeof b&&b.notQlist||Ka.getAttribute(NOT_QLIST_ATTRIBUTE)))return Ka.setAttribute(NOT_QLIST_ATTRIBUTE,"true"),Ja.notQlist(b,c);var La=this,Ma=[{name:"mkey",selector:"name"},{name:"q_mkey_type",selector:"q_mkey_type"},{name:"vdom",selector:"vdom"},{name:"q_type",selector:"q_type"},{name:"q_type_extra",selector:"q_type_extra"},{name:"q_ref",selector:"q_ref"},{name:"q_static",selector:"q_static"},{name:"q_path",selector:"q_path"},{name:"q_name",selector:"q_name"}],Na={source:[],columns:[],row_attr:[],section_attr:[],default_columns:[],sort_compare:K,categories:[],sort_categories_fn:function(a,b){return a.localeCompare(b)},sections:[],sort_sections_fn:K,section_widgets:[],row_gen:function(a,b){},format_fn:a.extend({},a.qlist.format_fn),after_format_fn:null,filter_fn:{"*":H},filter:function(a){return!0},category:{sorted:!0,collapsible:!0,editable:!1,q_type:null},paging:{enabled:!1,server_side:!1,hybrid_server_paging:!1,total_lines:0,page_lines:top.state?top.state.lines_per_page:50,min_page_lines:10,timeout:500,fetch:function(a,b){},show_all_button:!1,last_page_button:!0},empty_msg:a.getInfo("no_entries"),prefix:void 0,options:{ref_column:!1,resizable_columns:!0,inline:!1,automatic_mkey_column:!0,collapsible_sections:{"*":!0},collapsible_categories:{"*":!0},editable_sections:!1,add_section_num:!0,add_category_num:!0,atomic_render:!1,click_ignore:null,disable_selection:!1,focusable_rows:!1,mobile_style:fweb.util.browser.responsive.isSmall(),is_touch:fweb.util.browser.isMobile()},reordering:{enable:!1,items:"tr.qlist_row",drag:"td:visible:first-child",refresh_on_drop:!1,onDrop:L},column_filters:{enabled:!1,value:null,exempts:["#"],log_type:4,filter_fn:J,server_side_reload:null,force_client_side:!1},callbacks:{pre_load:null,load:null,pre_paging:null,post_paging:null,pre_sort:null,post_reorder:null}};e(Na);var Oa=a(this).data("config")||Na,Pa="resize.refresh_";if("refresh"===b)return g(),this;if("reload"===b)return c!==!1&&p(),ha([]),a(this).qlist(),this;if("config"===b)return c?a(this).data("config",a.extend(!0,Oa,c)):Oa;var Qa={reset_columns:t,update_columns:u,clear_filters:v,clear_selection:w,filter:x,append_row:fa,select_row:ga,select_rows:ha,get_selected_entries:ia,reload_page:q,get_num_filtered_lines:ja,get_filtered_source:ka,clean_up:la,row_to_entry:C};if("string"==typeof b&&b in Qa)return Qa[b](c);var Ra=l("qlist_find"),Sa=-1,Ta="_qlist_located_row_"+Date.now();"find"===b?(b=void 0,Ra=c):Ra&&(Ra=JSON.parse(Ra));var Ua=La.data("qlist_state");null==Ua&&La.data("qlist_state",Ua={display_master:[]}),Ua.cache={source:{}};var Va={adjust_all_tables:Ga,qlistRefreshTable:Ia,get_column_value:G,get_filter_settings:z,get_filter_columns:S,add_filter:r,apply_filter:x,get_filtered_lines:Z,get_complete_filter_fn:W},Wa=f(b,La,{config:Oa,state:Ua,fn:Va},arguments);if(Wa!==j)return Wa;var Xa;b&&"source"in b&&(Xa=b.source,delete b.source);var Ya=["chosen_columns","columns","default_columns"];"object"==typeof b&&Ya.forEach(function(a){b[a]&&b[a].length&&(Oa[a]=[])}),a.extend(!0,Oa,b),Oa.prefix||(fweb.log.warn("No qlist prefix set in "+top.location.pathname),Oa.prefix="qlist"+top.location.pathname.replace(/\//g,"_")),a(this).data("config",Oa),void 0!==Xa&&(Oa.source=b.source=Xa),w(),h("preconfigure",La,{config:Oa,fn:Va}),Ra||(Ra=Oa.locate_row,Oa.locate_row=null),delete Oa.categories_map,Oa.column_map=a.makeObject(Oa.columns,function(){return this.selector||(this.selector="id"+Math.random())}),Oa.options.ref_column&&!d()&&(Oa.column_map&&Oa.column_map.q_ref||(Oa.column_map.q_ref={selector:"q_ref",lang_key:"ref",fld_type:"int"},Oa.columns.push(Oa.column_map.q_ref)),Oa.default_columns.length&&Oa.default_columns.indexOf("q_ref")<0&&Oa.default_columns.push("q_ref"));for(var Za,$a=a.makeObject(Oa.row_attr,function(){return this.name}),_a=0;Za=Ma[_a];_a++){if($a[Za.name]){if(Za=$a[Za.name],!Za)continue}else Oa.row_attr.push(Za);if(Oa.options.automatic_mkey_column&&"mkey"===Za.name&&Oa.default_columns.length&&a.inArray(Za.selector,Oa.default_columns)<0){var ab=a.extend({display:1},Oa.column_map[Za.selector]);ab.display&&Oa.default_columns.unshift(Za.selector)}}var bb=getQueryValue(window.location.href,"filter");Oa.ck_name={column:bb?Oa.prefix+"_column_settings_ext":Oa.prefix+"_column_settings",filter:bb?Oa.prefix+"_filter_settings_ext":Oa.prefix+"_filter_settings",category:Oa.prefix+"_category_settings"};var cb=[],db=o.get(Oa.ck_name.column),eb=db&&db.split(",")||(Oa.chosen_columns&&Oa.chosen_columns.length?Oa.chosen_columns:Oa.default_columns.length?Oa.default_columns:cb);a.each(Oa.columns,function(b,c){if(!(c.hidden||d()&&c.hide_mobile===!0)){cb.push(c.selector),"lang_key"in c||(c.lang_key=a.hasInfo("field_"+c.selector)?"field_"+c.selector:c.selector);var e=a.inArray(c.lang_key,eb);e>=0&&c.selector&&(eb[e]=c.selector),c.fixed&&eb.indexOf(c.selector)===-1&&eb.unshift(c.selector)}}),eb=a.grep(eb,function(b){return a.inArray(b,cb)!==-1}),Oa.chosen_columns=eb,F(Oa.chosen_columns),Oa._api={};var fb=/([+\-]?\d+(?:.\d+)?)/,gb=1;h("postconfigure",La,{config:Oa,fn:Va});var hb,ib;return this.each(function(){function b(b){b.append('<div class="qlist-fixed-head"></div><div class="qlist-table"><table></table></div>');var c=b.find(".qlist-table > table"),d=a("<thead/>").appendTo(c),e=a("<tr/>").appendTo(d).addClass("heading");return Oa.options.inline&&b.addClass("inline-qlist"),{table:c,thead:d,headRow:e}}function c(){q.on("contextmenu",function(a){return a.preventDefault(),va(l,a),!1})}function e(){f()}function f(){if(d()?a("<th/>").appendTo(q).data("selector","_dummy_column"):a(Oa.chosen_columns).each(function(b,c){var d=a("<th/>").appendTo(q).data("selector",c),e=Oa.column_map[c]||{};for(var f in e)e.hasOwnProperty(f)&&"selector"!==f&&"lang_key"!==f&&d.attr(f,e[f]);var g=ta(d,e);g&&d.append(g)}),Oa.default_columns.length){var b="th:not([fixed])";q.find(b).addClass("sortable"),q.sortable({items:b,helper:"clone",start:function(a,b){b.item.data("start-pos",b.item.index())},update:function(b,c){var d=Oa.chosen_columns,e=c.item.data("start-pos"),f=c.item.index(),g=c.item.data("selector"),h=a.inArray(g,d),i=d.splice(h,1);d.splice(h+(f-e),0,i.pop());var k=a.Event("column_reorder");j.trigger(k,[g,d]),o.put(Oa.ck_name.column,d.join(",")),a(j).qlist("reload")},distance:15}).disableSelection()}}function g(){h("preinit",j,{config:Oa,state:m,fn:Va}),Oa.qlist=k=oa(n,void 0,l),setTimeout(function(){Ha(n)}),Oa.options.ref_column&&!d()&&n.on("click","a.qlist_ref",function(){var b=a(this).closest("tr.qlist_row"),c=b.attr("mkey"),d=b.attr("vdom");if(null!=c){var e=[b.attr("q_type")],f=b.attr("q_type_extra");null!=f&&(e=e.concat(f.split(","))),fweb.util.structure.topPostMessage({messageType:"showObjectUsage",qTypes:e,mkey:c,vdom:d})}return!1});var b,c=function(b){var c=a(b),d=!c.is(".active");return c.toggleClass("active",d),d};Oa.categories.length&&(b=".qlist_category label.visual-toggle-label",n.on("click",b,function(b){if(b.stopPropagation(),a(b.target).is("button")){var d=c(b.target),e=a(this).closest("tbody");e.nextAll("tbody:first").toggleClass("hidden",!d);var f=e.data("category");i(f,d),Fa(n),j.trigger("qlist_expansion_change")}}).on("dblclick",b,function(a){a.stopPropagation()})),Oa.sections.length&&(b=".qlist_section label.visual-toggle-label",n.on("click",b,function(b){var d=a(this);if(d.is("label.collapsible")&&b.stopPropagation(),a(b.target).is("button")){var e=c(b.target),f=d.closest("tr");f.nextUntil(".qlist_section").toggleClass("hidden",!e);var g=f.data("section");i(g,e),Fa(n),j.trigger("qlist_expansion_change")}}).on("dblclick",b,function(b){a(this).is("label.collapsible")&&b.stopPropagation()})),Fa(n),h("postinit",j,{config:Oa,state:m,table:n,thead:p,head_row:q,tbody:r,qlist:k,fn:Va}),j.trigger("qlist_load_that");var e=a(window);if(e.trigger("qlist_load"),Oa.prefix){var f=Pa+Oa.prefix;e.off(f),e.on(f,a.debounce(50,function(){j.qlist("refresh")}))}j.on("qlist.update",function(){j.qlist("refresh")}),a.isFunction(Oa.callbacks.load)&&Oa.callbacks.load.call(j[0],k),h("postload",j,{config:Oa,state:m,table:n,thead:p,head_row:q,tbody:r,qlist:k,fn:Va})}function i(b,c){var d=(o.get(Oa.ck_name.category)||"").split(","),e=a.inArray(b,d);if(c&&e<0)d.push(b);else{if(c||!(e>=0))return;d.splice(e,1)}o.put(Oa.ck_name.category,d.join(","))}var j=a(this);j.find("#"+Oa.prefix+"-extra_hdr_items").detach().addClass("hidden").appendTo(a("body")),j.find("#"+Oa.prefix+"-ext_hdr_items").detach().addClass("hidden").appendTo(a("body")),j.empty().addClass("qlist"),j.toggleClass("mobile",d());var l=j,m=j.data("qlist_state")||{};j.state=m,j.data("qlist_state",m),m.display_master&&m.display_master.length!==Oa.source.length&&"undefined"!=typeof get_new_display_master&&(ib=m.display_master=get_new_display_master()),window._new_display_master&&Oa.options.sorting&&m.sorting.length>0&&(sorting_cookie_data||!Oa.default_sort_is_serverside)&&_do_sort.call(j),hb=b(a(this));var n=hb.table,p=hb.thead,q=hb.headRow,r=a("<tbody/>").appendTo(n);h("preload",j,{config:Oa,state:m,table:n,thead:p,head_row:q,tbody:r,fn:Va}),a.isFunction(Oa.callbacks.pre_load)&&Oa.callbacks.pre_load.call(j[0],k),m._rows_ready=ma(r,l).done(function(){g(),c(),A(p),j.qlist("refresh")}),e()}),this.internationalizeLanguageEntries()},a.qlist.ext={};var p={},q=[];b(a,"qlist._ext").resolve_config=b}(jQuery),function(a,b){"use strict";function c(e,f,g){function h(){var a=z;if(a.$qlistElem){var b=a.$qlistElem.find("table tbody"),c=b.find("tr").not(a.fixed&&a.fixed.$tr);c.remove(),a.fixed&&a.fixed.$tr&&a.fixed.$tr.detach();for(var d=0;d<a.ctxt.length;++d)m(a.ctxt[d]);a.fixed&&a.fixed.$tr&&b.append(a.fixed.$tr)}}function i(a){z.$qlistElem.qlist("select_rows",[]),z.ctxt.replaceAll(a),z.refresh_qlist()}function j(a,b){return"data-"+escapeHTML(b)+'="'+escapeHTML(a)+'" '}function k(){var b=a.isFunction(z.defaults)?z.defaults():z.defaults,c=null;c=a.isArray(b)?b.map(function(b){return a.extend(!0,{},b)}):[a.extend(!0,{},b)];var d=l(c);setTimeout(function(){z.qlist("select_row",d[0]),o()},0)}function l(a){function b(){var a=-1,b=0,c=e.length;for(b=0;b<c;++b)a=Math.min(a,e[b][z.key]-1);return a}var c,d,f;for(c=0;c<a.length;c++)d=a[c],void 0===d[z.key]&&(d[z.key]=b()),e.push(d),f=m(d);return f}function m(a){var b;z.fixed&&z.fixed.$tr&&(b=z.fixed.$tr.parent(),z.fixed.$tr.detach()),z.$qlistElem.find(".empty_row").remove();var c=z.qlist("append_row",a);return b&&b.append(z.fixed.$tr),z._init_row(a,c),z._modified(y.CREATE,e,a,void 0,c),z.updateMenus(),c}function n(a,b){z.fixed={row:a,submit:b}}function o(b,c){function f(a,b){return a.map(function(a){return a+b}).join(" ")}function g(b){if("blur"===b.type||"keydown"===b.type&&b.keyCode===a.ui.keyCode.ENTER||"click"===b.type&&i.is(".editing")){var c=[],f=e.filter(z._row_match(m))[0];if(void 0===f&&z.fixed&&z.fixed.$tr[0]===i[0]&&(f=z.fixed.row),f){var g=i.find("span.inline-edit-group");g.each(function(){var b=a(this),d=b.data("group-name"),g=[],h=[];b.find("input.inline-edit-chk:checked").each(function(b,c){g.push(a(c).val()),h.push(a(c).parent(".inline-edit-chk-text").text())}),f[d]=g.join(" "),k.filter('[data-name="'+d+'"]').text(h.join("/")),b.closest(".inline-edit:not(input, select, .inline-edit-group)").attr("data-value-"+d,f[d]),c.push([e,f,d,i,b.closest("td")])}),j.filter(":not(.inline-edit-chk)").each(function(){function b(){var a=j.find('option[value="'+escapeHTML(m)+'"]'),b=a.data("class"),c=a.data("icon-class");b=b?" "+b:"",r.removeClass().addClass("inline-display depends "+l+b),r.find("f-icon").removeClass().addClass(c),r.find("span").text(a.text())}function g(){var b=j.is(":checked"),c=b?"":"un";f[l]=j.data(c+"checked-value"),r.find("f-icon").toggleClass("fa-enabled",b).toggleClass("fa-disabled",!b).attr("title",a.getInfo(f[l]))}function h(b){var c=a(b),d=c.data("inline-new-value");d&&a.when(d).then(function(a){if(d===c.data("inline-new-value")){c.data("inline-new-value",null);var b=c.data("filename-selector");f[l]=a.content,b&&void 0!==a.name&&(f[b]=a.name)}})}var j=a(this),l=j.data("name"),m=j.val(),n="input"===this.tagName.toLowerCase(),o="select"===this.tagName.toLowerCase(),p=n&&"checkbox"===this.type&&j.hasClass("toggle-switch"),q=n&&"file"===this.type;l||(l=j.closest(".inline-edit").find("[data-name]").data("name")),p||q||f[l]===m||void 0===l||(f[l]=m);var r=k.filter('[data-name="'+l+'"]');p?g():q?h(this):o?b():(n&&"password"===this.type&&(m=m.replace(/./g,d)),r.text(m)),j.closest(".inline-edit:not(input, select)").attr("data-value-"+l,f[l]),c.push([e,f,l,i,j.closest("td")])}),i.toggleClass("editing",!1),a.each(c,function(a,b){z._modified.apply(z,[y.EDIT].concat(b))}),z.submitted&&(z._validate(),z.updateMenus())}return clearTimeout(z._editingTimoutID),n.off(t),!1}}var h=10;if(!z.config.read_only){var i=z.$qlistElem.find("tr.selected"),j=i.find("input.inline-edit,select.inline-edit,label.inline-edit input[type=checkbox].toggle-switch,.inline-edit input[type=file]"),k=i.find(".inline-display"),l=c&&c.event?a(c.event.target):j.first(),m=i.data(z._data_key),n=a("html").add(z.$qlistElem);j.each(function(a,b){var c=z.id+"-"+m+"-"+b.getAttribute("data-name");b.name=b.name||c,b.id=b.id||c}),i.toggleClass("editing",!0),j=j.filter("input, select"),l.is("td, tr")||(l=l.parents("td").first()),l=l.find("input.inline-edit, select.inline-edit").first(),l.length||(l=j.first());var o=".qlist_inline_editing",p=["click","mousedown","mouseup","focus"],q=f(p,o),r="change"+o,s="keydown"+o,t="click"+o;z._editingTimoutID=setTimeout(function(){j.ui_dependencies().each(function(a,b){try{b.setSelectionRange&&b.setSelectionRange(0,999999)}catch(a){}}),l.focus(),n.off(t).on(t,function(b){var c=a(b.target).closest("tr.editing, .qtip, .ui-dialog, .ui-widget-overlay"),d=c.find(z.$qlistElem).length>=1;if(!c.length||d){var e=j.first().get();g.call(e,b),j.off(o)}else b.stopPropagation()})},h),j.off(o),j.on(q,function(a){a.stopPropagation()}),j.on(r,function(){function b(a){return a.name}var c=e.filter(z._row_match(m))[0],d=a(this),f=d.closest("td"),g=d.data("name")||f.find(".inline-edit [data-name]").data("name");if(c)if("file"===d.attr("type")){var h=z._modified(y.CHANGE,e,c,g,i,f,d[0].files),j=this.files,k=this.multiple;h||(h={name:Array.prototype.slice.call(j).map(b).join(", "),content:k?j:j[0]}),h=a.when(h).then(function(a){var b=f.find('[data-name="'+g+'"]');return b.val(a.content),f.closest("form").validate().element(b),f.find(".inline-edit .filename").text(a.name),a}),d.data("inline-new-value",h)}else z._modified(y.CHANGE,e,c,g,i,f,d.val())}),j.on(s,function(b){b.which===a.ui.keyCode.ENTER&&(g.call(b.target,b),b.preventDefault())})}}function p(){var b=z.$qlistElem.find("tr.selected"),c=b.map(function(b,c){return a(c).data(z._data_key)}).toArray(),d=[];e.replaceAll(a(e).not(function(b,e){var f=a.inArray(e[z.key],c)>-1;return f&&d.push(e),f}).toArray()),b.remove(),z.$qlistElem.find("tr[data-source-index]").attr("data-source-index",function(a){return a}),z._modified(y.DELETE,e,d,void 0,b),z.updateMenus()}function q(a){if(void 0===a||"string"==typeof a)return"";var b=Object.keys(a).map(function(b){if("class"!==b){if("function"!=typeof a[b])return escapeHTML(b)+'="'+escapeHTML(a[b])+'"';a.class=(a.class||"")+" "+b}});return b.join(" ")+" "}function r(b,c,e,f,g,h){e=e||"text";var i=a.map(g||{},j).join("")+" ",k=q(f);k||(f={class:f});var l=c[b];return void 0===l&&(l=""),"password"===e&&(c._password_orig=c._password_orig||{},c._password_orig[b]=c[b],l=l.replace(/./g,d)),'<span class="inline-display '+b+(g?" depends":"")+'" '+i+'data-name="'+b+'">'+escapeHTML(l)+'</span><input class="inline-edit'+(g?" depends":"")+(f.class?" "+f.class:"")+'" '+k+i+'type="'+e+'" data-name="'+b+'" value="'+escapeHTML(c[b])+'" placeholder="'+(h?h:"")+'" />'}function s(b,c,d,e,f){var g=a.map(f||{},j).join("");if(a.isArray(d)){var h=d;d={},a.each(h,function(b,c){d[c]=a.getInfo(c)})}var i=c[b]?c[b].split(" "):[],k=[],l=[];return a.map(d,function(c,d){var h,j,m=escapeHTML(d),n="";if(a.isPlainObject(c)){h=c.text||a.getInfo(d);var o=c.data||{};for(j in o)o.hasOwnProperty(j)&&(n+=" data-"+escapeHTML(j)+'="'+escapeHTML(o[j])+'"');c.class&&(n+=' data-class="'+escapeHTML(c.class)+'"')}else h=c;h=escapeHTML(h),a.inArray(d,i)>=0&&k.push(h),l.push('<label class="inline-edit inline-edit-chk-text"><input class="inline-edit qlist_col_field inline-edit-chk'+(f?" depends":"")+(e?" "+e:"")+'" '+g+'type="checkbox" data-name="'+b+'" '+(a.inArray(d,i)>=0?"checked":" ")+' value="'+m+'"/>'+h+"</label>")}),'<span class="inline-display '+b+(f?" depends":"")+'" '+g+'data-name="'+b+'">'+k.join("/")+'</span><span class="inline-edit inline-edit-group checkbox-group" data-group-name="'+b+'">'+l.join(" ")+"</span>"}function t(d,e,f,g){var h=['<span class="inline-edit button-column {{ eSelector }}">','   <span class="filename">{{ filename }}</span>','   <input type="text" ','       class="hidden dependency_ignore_visibility validate_hidden {{ validate_class }}" ','       value="{{ content }}"','       id="{{ id }}"','       data-name="{{ eSelector }}">','   <input type="file" class="hidden depends" ','       data-class-if-class="error error #{{ id }}"','       id="{{ id }}_file" accept="{{ accept }}" ','       data-filename-selector="{{ filename_selector }}">','   <label for="{{ id }}_file">','       <f-icon class="fa-plus-circle"></f-icon>',"       <span>{{ text }}</span>","   </label>","</span>"].join("\n");return b.util.dom.renderTemplate(h,{validate_class:f||"",eSelector:escapeHTML(d),id:"inline-file-"+c.lastId++,text:g.lang?a.getInfo(g.lang):"",content:escapeHTML(e[d]),accept:g.accept,filename_selector:escapeHTML(g.filename_selector),filename:escapeHTML(e[g.filename_selector])||a.getInfo("Not Set")})}function u(b,d,e,f,g){var h=escapeHTML(b),i="inline-toggle-"+c.lastId++,k=d[b]===e?"fa-enabled":"fa-disabled",l=a.map(g||{},j).join(""),m=escapeHTML(a.getInfo(d[b]));return e=escapeHTML(e),f=escapeHTML(f),'<span class="inline-display '+h+(g?" depends":"")+' toggle-label"'+l+' data-name="'+h+'"><f-icon class="'+k+'" title="'+m+'"></f-icon></span><label class="inline-edit toggle-label'+(g?" depends":"")+'" for="'+i+'"'+l+'><input type="checkbox" class="toggle-switch" id="'+i+'" data-checked-value="'+e+'" data-unchecked-value="'+f+'" data-name="'+h+'" value="'+e+'" ><label for="'+i+'"></label></label>'}function v(b,c,d,e,f){if(a.isArray(d)){var g=d;d={},a.each(g,function(b,c){d[c]=a.getInfo(c)})}var h=escapeHTML(b),i=c[b],k=d[i],l=a.isPlainObject(k)?k.text||a.getInfo(i):k,m=a.isPlainObject(k)?k.class:"",n=a.isPlainObject(k)?k["icon-class"]:"",o=q(e);return o||(e={class:e}),'<span class="inline-display '+h+" "+(m?m:"")+'" data-name="'+h+'">'+(n?'<f-icon class="'+n+'"></f-icon>':"")+"<span>"+escapeHTML(l||"")+'</span></span><select class="inline-edit'+(f?" depends":"")+(e.class?" "+e.class:"")+'" '+o+a.map(f||{},j).join("")+'data-name="'+h+'">'+a.map(d,function(b,c){var d,e,f=escapeHTML(c),g="";if(a.isPlainObject(b)){d=b.text||a.getInfo(c);var h=b.data||{};for(e in h)h.hasOwnProperty(e)&&(g+=" data-"+escapeHTML(e)+'="'+escapeHTML(h[e])+'"');b.class&&(g+=' data-class="'+escapeHTML(b.class)+'"'),b["icon-class"]&&(g+=' data-icon-class="'+escapeHTML(b["icon-class"])+'"')}else d=b;return d=escapeHTML(d),'<option value="'+f+'" '+(c===i?"selected":"")+g+">"+d+"</option>"}).join("")+"</select>"}c.lastId=(c.lastId||0)+1,this.id=c.lastId;var w={key:"id",max_rows:null};f=a.extend(w,f);var x,y=c.operations,z=this;this._subscribers=[],this.menuSelector=g,e.jquery&&e.length&&(x=e,e=JSON.parse(e.val())),a.each(e,function(a,b){f.key in b||(b[f.key]=a)}),e.replaceAll=function(a){var b=[0,this.length].concat(a);Array.prototype.splice.apply(this,b)},a.extend(this,{ops:c.operations,config:f,key:f.key,_data_key:"row-handler-"+f.key,ctxt:e,$store:x,submitted:!1,append_rows:l,add_row_to_table:m,add_fixed_row:n,inline_create:k,inline_edit:o,inline_delete:p,input_format:r,select_format:v,toggle_format:u,file_format:t,multiple_checkbox_format:s,refresh_qlist:h,replace_contents:i,menu_scope_init_fns:[],menu_scopes:[]})}var d="";if(c.operations={INIT:"init",MOVE:"move",CREATE:"create",DELETE:"delete",EDIT:"edit",CHANGE:"change"},a.extend(c.prototype,{qlist:function(){return this.$qlistElem.qlist.apply(this.$qlistElem,arguments)},modified:function(){},subscribe:function(a,b){if("function"==typeof a&&(b=a,a=null),void 0===a)throw new Error("Invalid arguments. Please specify a valid operation, null or omit it completely");var c={cb:b,op:a};this._subscribers.push(c);var d=function(){var a=this._subscribers.indexOf(c);a>-1&&this._subscribers.splice(a,1)}.bind(this);return d},_modified:function(a){var b=this.modified.apply(this,arguments);return this._subscribers.forEach(function(c,d){var e,f=d.op===a,g=d.op&&Array.isArray(d.op)&&d.op.indexOf(a)!==-1;if(f&&(c=Array.prototype.slice.call(c,1)),!d.op||g||f){if(e=d.cb.apply(this,c),b&&e)throw new Error("Only one subscriber may return a result/promise");b||(b=e)}}.bind(this,arguments)),b},_init_row:function(b,c){function d(a,b,c){function d(a){return a!==b}function e(a){return a[c]}return function(){return a().filter(d).map(e)}}function e(a){return function(b){return b.selector===a}}var f=/(^|\b)InlineHandlerDupChecker($|\b)/,g=c.find(".InlineHandlerDupChecker");g.each(function(c,g){var h=a(g),i=h.data("name"),j=this.config.qlist_config,k=j.columns.filter(e(i))[0],l=k&&k.validate&&(k.validate.InlineHandlerDupChecker||f.test(k.validate.class));if("string"!=typeof k.validate||l||(l=f.test(k.validate)),l){if(l===!0){var m=this.ctxt;l=function(){return m}}h.addClass("ValueDupChecker"),h.data("ValueDupChecker",d(l,b,i))}}.bind(this))},_subscribers:null,set_defaults:function(a){this.defaults=a},menu_scope_init:function(a){this.menu_scope_init_fns.push(a)},attach:function(b){function d(a,b,c){return a.addClass("inline"),l.select_format(b.selector,c,b.options,b.validate,b.deps)}function e(a,b,c){return a.addClass("inline"),l.toggle_format(b.selector,c,"enable","disable",b.deps)}function f(a,b,c){return a.addClass("inline"),l.input_format(b.selector,c,b.inline_type,b.validate,b.deps,b.placeholder)}function g(c){function g(b,d){var e=n+[m.name,c.selector,d.name].join("."),f=a.getInfo(e,!0,!0);return b[d.name]=f||d.name,b}var h=c.selector,i=m&&m.children[h];b.format_fn[h]||("options"in c||!i||!i.options||(c.options=i.options.reduce(g,{})),c.options?"disable,enable"===Object.keys(c.options).sort().join(",")?b.format_fn[h]=e:b.format_fn[h]=d:b.format_fn[h]=f)}function h(){require(["angular","jquery.ng_app"],function(b,c){var d=a(l.menuSelector),e=b.module(l.menuSelector,[]);e.controller(c.DEFAULT_QLIST_MENU_ITEMS_CONTROLLER,["$scope",i]),d.ng_app({modules:[l.menuSelector]})})}function i(c){if(!c.__TESTING__){c.handlers={};var d=a.extend({},{create:{handler:l.inline_create},edit:{handler:l.inline_edit},delete:{handler:l.inline_delete}},b.menu_items||{});Object.keys(d).forEach(function(a){c[a]=d[a].handler}),c.qlistSelector=l.qlistSelector,l.menu_scopes.push(c),l.updateMenus(),c.createEnabled=function(){return this.menusEnabled.create},c.editEnabled=function(){return this.menusEnabled.edit},c.editCliEnabled=function(){return!1},c.cloneEnabled=function(){return this.menusEnabled.clone},c.deleteEnabled=function(){return this.menusEnabled.delete},l.menu_scope_init_fns.forEach(function(a){a(c)})}}var j,k,l=this,m=this.config.schema,n=this.config.option_lang_prefix||"";if(b.row_attr=b.row_attr||[],b.row_attr.push({name:"data-"+this._data_key,selector:this.key}),b.options=b.options||{},b.options.inline=!0,b.columns){b.format_fn=b.format_fn||{},j=b.columns.length;for(var o=0;o<j;++o)g(b.columns[o])}return b.source||(b.source=this.ctxt),b.callbacks=b.callbacks||{},k=b.callbacks.load,b.callbacks.load=function(){var b=c.operations;l.$qlistElem=a(this),a.isFunction(k)&&k.apply(this,arguments),l.$qlistElem.find("tr").each(function(){var c=this.getAttribute("data-row-handler-id"),d=l.ctxt.filter(l._row_match(c))[0],e=a(this);l._init_row(d,e),l._modified(b.INIT,l.ctxt,d,null,e)}),l.fixed&&(l.fixed.$tr=l.add_row_to_table(l.fixed.row),l.fixed.$tr.removeAttr("data-source-index"),l.fixed.$tr.toggleClass("pol_implicit implicit",!0)),l.selected=[],l.$qlistElem.on("qlist_select_rows.inline_handlers",function(a,b){l.selected=b.entries.filter(function(a){return!!a}),l.fixed&&l.fixed.$tr.hasClass("selected")&&(l.selected.push(l.fixed.row),l.selected.fixed=!0),l.updateMenus()}),h()},this.config.qlist_config=b,b},update_form:function(){this.submitted=!0;var a=this.fixed&&this.fixed.submit?[this.fixed.row]:[];if(this.$store){var b=this.ctxt.concat(a).map(function(a){if(a._password_orig){var b={};for(var c in a)c in a._password_orig&&a._password_orig[c]===a[c]||(b[c]=a[c]);return b}return a});this.$store.val(JSON.stringify(b))}return this._validate()},_validate:function(){var b,c=!0,d=this,e=d.config.qlist_config.columns,f=this.$store||this.$qlistElem;if(!f)return!0;var g=f.closest("form").get(0);return b=a(g).validate(),a.each(this.ctxt,function(f,g){var h=d.$qlistElem.find('[data-row-handler-id="'+g[d.key]+'"]');h.toggleClass("editing",!0),a.each(e,function(d,e){if(e.validate){var f=h.find("."+e.selector+" .inline-edit");f.is(":input")||(f=f.find(":input").first()),f.each(function(){var d=a(this);c=b.element(d)&&c,c&&d.prop("name",null)})}}),h.toggleClass("editing",!1)}),c},updateMenus:function(){if(this.menu_scopes.length){var b=this.config.max_rows;b&&a.isFunction(b)&&(b=b());var c=(null===b||this.ctxt.length<b)&&!this.config.read_only,d=this.selected.length,e=function(a){a.menusEnabled=a.menusEnabled||{},a.menusEnabled.create=c,a.menusEnabled.edit=!this.config.read_only&&1===d,a.menusEnabled.delete=!this.config.read_only&&!this.selected.fixed&&d>0}.bind(this);this.menu_scopes.forEach(function(a){a.$$phase?e(a):a.$apply(e)})}},_row_match:function(a){var b=this;return function(c){return String(c[b.key])===String(a)}}}),void 0!==window.QListInlineHandlers)throw new Error("QListInlineHandlers already defined");window.QListInlineHandlers=c}(jQuery,fweb),function(a){"use strict";function b(a){for(var b=[],c=0;c<a;++c)b.push(c);return b}function c(a){return a+"_sorting_settings"}function d(b,c){var d,e,f,g,h={selector:"",direction:""};if(a.isArray(b)){for(e=b.length,d=0;d<e;d++){g=b[d];for(f in g)g.hasOwnProperty(f)&&!h.hasOwnProperty(f)&&delete g[f]}b=a.grep(b,function(a){for(var b in h)if(h.hasOwnProperty(b)&&!a.hasOwnProperty(b))return!1;return c.column_map.hasOwnProperty(a.selector)})}else b=void 0;return b}function e(a,b){return a<b?-1:a>b?1:0}function f(b,c){function d(b){var c=typeof b;return"object"===c?a.type(b):c}var e,f,g,h,i;if(e=d(b),g=d(c),e===g)if("string"===e){if(b=b.toLowerCase(),c=c.toLowerCase(),b===c)return 0;if(null===(f=u.exec(b))||null===(h=u.exec(c))||f[1]!==h[1])return v.test(b)&&v.test(c)?b>c?1:b===c?0:-1:b.localeCompare(c);if(i=parseInt(f[2],10)-parseInt(h[2],10),0!==i)return i}else{if("number"===e)return b-c;if(null==b)return 0}return null==c&&(c="number"===e?1/0:"z"+c),null==b&&(b="number"===g?1/0:"z"+b),b<c?-1:b>c?1:0}function g(a,b){return a-b}function h(a,b){return b||n.IP_HOST.test(a)?(a=a.split("."),a.reduce(function(a,b,c){return(a|parseInt(b,10)<<8*(3-c))>>>0},0)):16777215}function i(a,b){if(!b&&!n.IP6_HOST.test(a))return a;var c,d=[],e=a.split("::");if(2===e.length){var f=e[0].split(":"),g=e[1].split(":");1===f.length&&""===f[0]&&(f=[]),1===g.length&&""===g[0]&&(g=[]);var h=8-(f.length+g.length);for(c=0;c<f.length;c++)d.push(f[c]);for(c=0;c<h;c++)d.push(0);for(c=0;c<g.length;c++)d.push(g[c])}else 1===e.length&&(d=a.split(":"));var i;for(c=0;c<d.length;c++)i=d[c],d[c]="0000".substr(i.length)+i;return d.join("").toLowerCase()}function j(a,b){return a=k(a),b=k(b),"number"==typeof a&&"number"==typeof b?a-b:a>b?1:a===b?0:-1}function k(a){return n.IP_HOST.test(a)?h(a,!0):n.IP6_HOST.test(a)?"1"+i(a,!0):"26553565535655356553565535655356553565535"}function l(a){return k(a.split("/")[0])}var m=fweb.util.dom.try_JSON_parse,n=fweb.util.patterns.commonRegExp,o={remove:fweb.util.persist.removeCookie,get:function(a){return m(fweb.util.persist.getCookie(a))},put:function(a,b){return fweb.util.persist.setCookie(a,JSON.stringify(b))}},p=function(){};p.prototype.init=function(){this._sorting_cache={}},p.prototype.preload=function(b,c){if(this.core_config=c.core.config,this.config=this.core_config.sort,this.core_state=c.core.state,this.el=a(b),this.internal_fns={qlistRefreshTable:c.core.fn.qlistRefreshTable},null==this.core_state.sorting){var e;this.config.save_in_cookie&&(e=d(o.get(this.cookie_name),this.core_config)),this.core_state.sorting=e||this.core_config.default_sort}this.resortIfNeeded()},p.prototype.postload=function(b,c){this.head_row=c.core.head_row,this.add_sortable_indicators(),this.set_current_sort_icon(),this.head_row.off("click.sort"),this.head_row.on("click.sort",a.proxy(this,"onHeaderClick")),this.el.on("reset_columns.sort",a.proxy(this,"reset_sorting"))},p.prototype.resetDisplayMasterIfNeeded=function(){var a=this.getSource(),c=this.getDisplayMaster();return(null==c||c.length!==a.length)&&(this.setDisplayMaster(b(a.length)),!0)},p.prototype.destroy=function(){this.core_state=null,this.core_config=null,this.el=null,null!=this.head_row&&this.head_row.off("click.sort"),this.head_row=null,this.internal_fns=null},p.prototype.onHeaderClick=function(b){if(!this.core_config.options.fixed_sort){var c=this.core_config,d=c.options.sort_columns,e=a(b.target).closest("th"),f=e.data("selector");a.isFunction(c.callbacks.pre_sort)&&c.callbacks.pre_sort(b,e,f),this.el.find("tr.empty_row").length>0||(c.sort_fn["*"]||f in c.sort_fn)&&(b.stopPropagation(),d&&!d[f]||this.do_sort_toggle(f))}},p.prototype.prepareFastSort=function(a){this.core_config.fast_sort=[],this.core_config.fast_sort_target=a},p.prototype.disableFastSort=function(){this.core_config.fast_sort=void 0},p.prototype.checkFastSort=function(a){this.config.fast_update===!1||this.core_config.paging.enabled||null!==this.core_config.category.q_type&&null!=this.core_config.column_map.category?this.disableFastSort():this.prepareFastSort(a||this.el.find("tbody").eq(0))},p.prototype.fastSortEnabled=function(a){return a&&this.checkFastSort(),void 0!==this.core_config.fast_sort},p.prototype.clear_sorting_cache=function(){this.core_state.display_master=b(this.getSource().length),this._sorting_cache={},this.checkFastSort()},p.prototype.reset_sorting=function(){this.clear_sorting_cache(),this.source_order_indicator=!1,this.setSortValue(this.getDefaultSort()),o.remove(this.cookie_name);var a=this.getSortValue();null!=a&&a.length>0&&this._do_sort()},p.prototype.getSortValue=function(){
return this.core_state.sorting},p.prototype.setSortValue=function(a){this.core_state.sorting=a},p.prototype.getDisplayMaster=function(){return this.core_state.display_master},p.prototype.setDisplayMaster=function(a){this.core_state.display_master=a},p.prototype.getSource=function(){return this.core_config.source},p.prototype.getDefaultSort=function(){return this.core_config.default_sort},p.prototype.source_load_complete=function(){this.resortIfNeeded()},p.prototype.resortIfNeeded=function(){var a=this.getSortValue();this.resetDisplayMasterIfNeeded()&&null!=a&&a.length>0&&null!=this.getSource()&&(a!==this.getDefaultSort()||!this.config.default_sort_is_serverside)&&this._do_sort()},p.prototype.set_current_sort_icon=function(){var b=this.getSortValue(),c=this.getSource(),d=this.core_config.options.sort_source_order;b&&b.length||!d||(b=[d],this.setSortValue(b));var e,f=(c.length>0||"then"in c)&&null!=b?b[0]:void 0;e=this.core_config.options.inline?this.head_row:this.el.find(".qlist-fixed-head tr.heading"),e.find("th").each(function(){var b,c=a(this),d=c.data("selector"),e=c.find(".sort-indicator");e.find(".current-sort").remove(),f&&d===f.selector&&(b="current-sort fa-sort-"+f.direction,e.append('<f-icon class="'+b+'"></f-icon>'))})},p.prototype.add_sortable_indicators=function(){var b=this.core_config;if(!b.options.fixed_sort){var c=b.options.sort_columns;this.el.find("tr.empty_row").length||this.head_row.add(this.el.find(".qlist-fixed-head tr.heading")).each(function(){a(this).find("th").each(function(){var d=a(this),e=d.data("selector");if((b.sort_fn["*"]||e in b.sort_fn)&&(!c||c[e])){d.addClass("can-sort");var f=d.find("> div");f.find(".sort-indicator").length||f.append('<div class="sort-indicator"><f-icon class="fa-sort"></f-icon></div>')}})})}};var q,r,s,t=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};p.prototype.do_sort_toggle=function(b){var c,d,e,f,g,h,i,j,k;for(c=this.core_config,j=this.getSortValue(),h=0,i=j.length;h<i;h++)if(g=j[h],g.selector===b){d=g.direction;break}if(c.options.sort_columns&&"string"==typeof c.options.sort_columns[b]){if(j.length&&j[0].selector===b)return;f=c.options.sort_columns[b]}else e=null!=(k=c.sort_fn[b])?k.directions:void 0,f=null!=e?e[(a.inArray(d,e)+1)%e.length]:"asc"===d?"desc":"asc";return this.do_sort([{selector:b,direction:f}])},p.prototype.do_sort=function(c){var e,f,g,h,i,j,k,l,m,n,p,s,u,v,w,x,y,z,A,B,C,D=this;if(e=this.core_config,m=null!=(A=this.getSortValue())?A.slice(0):void 0,p=q(m,this.prevServerSort),null!=c){for(n=this.getSortValue()[0],k=c[0],s=a.map(c,function(a){return a.selector}),u=this.getSortValue(),h={},g=a.grep(b(u.length),function(b){var c,d,e,f;return d=u[b],f=D.core_config.sort_fn[d.selector],f&&r(d,f)?(e=d.direction,c=t.call(h[d.selector]||[],e)>=0,c||(h[d.selector]||(h[d.selector]=[])).push(d.direction),c):a.inArray(d.selector,s)>=0}),B=g.reverse(),w=0,y=B.length;w<y;w++)j=B[w],u.splice(j,1);this.setSortValue(d(c.slice(0).concat(this.getSortValue()),this.core_config))}if(v=a.Event("sorting"),this.el.trigger(v,[m]),this.config.save_in_cookie&&o.put(e.ck_name.sorting,this.getSortValue()),v.isDefaultPrevented())return!1;if(f=this._do_sort(null!=c?c.length:void 0,p))return f;if(null!=this.core_state.fast_sort)for(C=this.getDisplayMaster(),x=0,z=C.length;x<z;x++)j=C[x],null!=(i=this.core_state.fast_sort[j])&&(i.appendTo(this.core_state.fast_sort_target),l?i.addClass("odd"):i.removeClass("odd"),l=!l);else this.internal_fns.qlistRefreshTable();return this.el.trigger("sort",[m]),!0},r=function(a,b){var c,d=!1;return"server"===b.kind||"complex"===b.kind&&b.server?d=!0:(c=b[a.direction]||b["*"])&&(d="server"===c.kind),d},s=function(a){var b,c,d,e,f;for(d=-1,c=e=0,f=a.length;e<f;c=++e)if(b=a[c],r(b,b.fn)){d=c;break}return d},q=function(a,b){var c,d,e,f,g;if(e=-1,null==b)return e;for(d=f=0,g=a.length;f<g;d=++f)if(c=a[d],b.selector===c.selector&&b.direction===c.direction){e=d;break}return e},p.prototype.isNewServerSort=function(a){var b;return b=this.prevServerSort,null!=a&&(null==b||a.selector!==b.selector||a.direction!==b.direction)},p.prototype.isGlobalServerSort=function(){var a=!1;return this.core_config.sort_fn["*"]&&(a=r({selector:"*",direction:"*"},this.core_config.sort_fn["*"])),a},p.prototype._doServerSort=function(a){var b,c,d;return null==a&&(a=0),d=this.core_config.sort_fn,b=this.getSortValue()[a],c=d[b.selector]||d["*"],"complex"===c.kind&&(c=c[b.direction]||c["*"]||c.server),c({current_sort:this.getSortValue(),target_sort:b,display_master:this.getDisplayMaster()})},p.prototype._do_sort=function(c,d){function h(){var a,b,c;for(c=[],a=0,b=z.length;a<b;a++)B=z[a],c.push(n.sort_fn[j.selector](B[j.selector]));return c}function i(){var a,b,c;for(c=[],a=0,b=z.length;a<b;a++)B=z[a],c.push(n.sort_fn[j.selector](B));return c}var j,k,l,m,n,o,p,q,r,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P=this;if(null==d&&(d=-1),n=this.core_config,0===this.getSortValue().length)return void this.setDisplayMaster(b());for(k=c?this.getSortValue().slice(0,c):this.getSortValue().slice(0),w=C=0,G=k.length;C<G;w=++C)j=k[w],A={fn:n.sort_fn[(O=j.selector)in n.sort_fn?O:"*"]},k[w]=a.extend(A,k[w]);if(this.isGlobalServerSort(o))return this._doServerSort()||!0;if(y=this.prevServerSort,p=s(k),o=this.getSortValue()[p],null!=o&&(this.isNewServerSort(o)||d!==-1&&p!==d))return this.prevServerSort=o,q=this._doServerSort(p),0===p&&this.setDisplayMaster(b()),q||!0;if(p>=0&&(k=k.slice(0,p)),null!==n.category.q_type&&null!=n.column_map.category){for(l={},K=this.getSource(),w=D=0,H=K.length;D<H;w=++D)t=K[w],t.category in l||(l[t.category]=w);m=function(a,b){return g(l[a],l[b])},k.unshift({selector:"category",direction:"asc",fn:m})}for(z=this.getSource(),E=0,I=k.length;E<I;E++)j=k[E],"key"!==(null!=(L=n.sort_fn[j.selector])?L.kind:void 0)||j.selector in this._sorting_cache?"key_row"!==(null!=(M=n.sort_fn[j.selector])?M.kind:void 0)||j.selector in this._sorting_cache||(this._sorting_cache[j.selector]=i(z,n)):this._sorting_cache[j.selector]=h(z,n);for(r=[],N=this.getDisplayMaster(),w=F=0,J=N.length;F<J;w=++F)x=N[w],r[x]=w;v=function(a,b,c,d){return"comp_row"===a.kind?a(z[c],z[d],f):a(z[c][b.selector],z[d][b.selector],f)},u=function(a,b,c,d){return"key"===a.kind?e(a(z[c][b.selector]),a(z[d][b.selector])):"key_row"===a.kind?e(a(z[c]),a(z[d])):v(a,b,c,d)},this.getDisplayMaster().sort(function(a,b){var c,d,f;if(null!=z[a]&&null!=z[b])for(f=0,d=k.length;f<d;f++){if(j=k[f],"key"===j.fn.kind||"key_row"===j.fn.kind)c=e(P._sorting_cache[j.selector][a],P._sorting_cache[j.selector][b]);else if("complex"===j.fn.kind)if("asc"in j.fn&&"asc"===j.direction)c=u(j.fn.asc,j,a,b);else if("desc"in j.fn&&"desc"===j.direction)c=u(j.fn.desc,j,a,b);else{if(!("ascdesc"in j.fn)||"asc"!==j.direction&&"desc"!==j.direction)return u(j.fn[j.direction],j,a,b);c=u(j.fn.ascdesc,j,a,b)}else c=v(j.fn,j,a,b);if(0!==c)return"asc"===j.direction?c:-c}return g(r[a],r[b])})},e.kind="comp";var u=/^(\D*)(\d{1,15})/,v=/^[\w\-.\s]*$/;f.kind="comp",h.kind="key",i.kind="key",j.kind="comp",k.kind="key",l.kind="key","undefined"==typeof a.qlist&&(a.qlist={}),"undefined"==typeof a.qlist.sort_fns&&(a.qlist.sort_fns={}),a.qlist.sort_fns.ip4_addr_sort=h,a.qlist.sort_fns.ip6_addr_sort=i,a.qlist.sort_fns.ip_addr_sort=k,a.qlist.sort_fns.ip_mask_sort=l,a.qlist.ext||(a.qlist.ext={});var w=a.qlist.ext.sort={config_path:"sort",managed:!0,enabled_config_path:"options.sorting",staticDepends:["display_master"],defaults:{fast_update:!0,save_in_cookie:!0,hidden_sort:[],default_sort_is_serverside:!1},core_defaults:{default_sort:[],options:{sorting:!1,sort_columns:null,fixed_sort:!1},sort_fn:{"*":f}},constructor:p,commands:{sort:function(b,c,d){var e=c.$self;if(null!=e)return"string"===a.type(d)?"clear_cache"===d?e.clear_sorting_cache():"reset"===d&&e.reset_sorting():e.do_sort(d),b},getSortValue:function(a,b){var c=b.$self;if(null!=c)return c.getSortValue()}},postconfigure:function(a,b){b.core.config.ck_name.sorting=c(b.core.config.prefix)},preload:function(b,d){var e=d.$self;return null==e&&(e=new p,e.init()),e.cookie_name=c(d.core.config.prefix),e.preload(b,d),"undefined"!=typeof angular&&a(b).one("$destroy",function(){e.destroy(),d.core.state.sort=null}),e},postload:function(b,d){var e=d.$self;return null==e&&(e=new p,e.init()),e.cookie_name=c(d.core.config.prefix),e.postload(b,d),"undefined"!=typeof angular&&a(b).one("$destroy",function(){e.destroy(),d.core.state.sort=null}),e},source_load_complete:function(a,b){null!=b.$self&&b.$self.source_load_complete()},load_row_frag:function(a,c){var d=c.core.state,e=d.display_master,f=c.core.config.source.length;e&&e.length===f||(e=d.display_master=b(f))}};window.qlist_sorting={ext:w,constructor:p,get_new_display_master:b,sort_fns:{ip4_addr_sort:h,ip6_addr_sort:i,ip_addr_sort:k,ip_addr_sort_compare:j,ip_mask_sort:l}}}(jQuery),function(a){"use strict";function b(b){return b.sort(function(b,c){var d=a.type(b),e=a.type(c);return d===e&&"array"===d?b[0]-c[0]:b<c?-1:b>c?1:0}).reduce(function(b,c){if("array"!==a.type(c))return b;if(0===b.length)return b.push(c),b;var d=b[b.length-1];return d[1]>c[1]?b:d[1]>c[0]?(d[1]=c[1],b):(b.push(c),b)},[])}function c(c,d,e){function g(a){r._config=a,j()}function h(a){a.classList&&a.classList.add(r._config.highlight_class)}function i(a,b){null==b&&(b=!0),a.toggleClass(r._config.highlight_class,b)}function j(){r._highlight_html=(null!=r._config.highlight_color?'style="background-color: '+r._config.highlight_color+';" ':"")+'class="'+r._config.highlight_class+'"'}function k(c,d){var e=b(c);if(e.length<1)throw new Error("Match array is invalid");var f="<span "+r._highlight_html+">";return a.each(e.reverse(),function(a,b){var c=b[0];"boolean"==typeof c&&(c=0),null==b[1]&&(b=[c,d.length]),d=d.slice(0,b[0])+f+String.prototype.slice.apply(d,b)+"</span>"+d.slice(b[1])}),d}function l(b,c,d){var e,f,g;if(e=null!=b.source?b.source:d,c===e)try{return k(b,c)}catch(a){}var h=b,i=b.source;if(a.isArray(b)?(h=a.grep(b,function(a){var b=a?a.source||i:i;return!!a&&("string"==typeof b&&fweb.util.patterns.htmlStringContains(c,b))}),g=h.length>0):g=fweb.util.patterns.htmlStringContains(c,e),g){var j=[];return j.length=h.length,f=a("<div>"),f.append(c),f.walkTextNodes(function(){for(var b,c=this.nodeValue,d=c.indexOf(e),f=!0,g=0,i=h.length;g<i&&(b=h[g],!0);g++)if(!j[g]){f=!1;var l=b.source||e,m=l===e?d:c.indexOf(l);if(m>=0){if(l===c&&this.classList&&this.classList.contains(r._config.highlight_class)){j[g]=!0;continue}try{a(this).replaceWith(c.slice(0,m)+k(h,l)+c.slice(m+l.length)),j[g]=!0;continue}catch(a){continue}}}if(f)return!1}),f.html()}}function m(b,c,d,e){var g,h;return"number"===a.type(c)&&(c=""+c),"string"===a.type(c)&&(g=l(b,c,d),null!=g)?g:(h=a("<div>"),h.append(c),null!=e&&e.is(".info_with_icon")||0!==h.has(f).length||(h=a("<span>"),h.append(c)),c instanceof a&&c.find("."+r._config.highlight_class).length>0||i(h),h)}function n(b,c,f){var g,h,j,k,l,n;if(null!=p.current_results){h=fweb.util.browser.responsive.isSmall()?b.closest("table").find("tr:not(.heading)"):b.closest("tr"),g=h.data("sourceIndex"),null==g&&(g=b.attr("atomicSourceIndex"),g&&(g=+g)),null==g&&(g=h.data("sectionFirstIndex")),j=g in p.current_results;var o=c;if(j){var q=p.current_results[g];if(j=c in q,!j&&c in d.config.column_map){var s=d.config.column_map[c];if(a.isArray(s.combine))for(var t=0,u=s.combine.length;t<u&&(o=s.combine[t],!(j=o in q));++t);}}if(r._config.fast_update)i(b,j);else{if(p.current_results&&p.current_results[g]&&(l=e(b,c,f,p.current_results[g][o]),j))return k=p.current_results[g][o],n=m(k,l,f[c],b),n instanceof jQuery&&d.config.options.atomic_render?a("<div>").append(n).html():n;if(null!=l)return l}}return e(b,c,f)}function o(a,b){if(null!=p.current_results){var c=p.current_results[b].__category_header;if(null!=c)return l(c,a)}return a}var p,q,r={};g(d.config.search);var s,t;return p=null==(s=d)?{}:null==(t=s.state)?{}:t.search||{},q=e,r.insert_highlighting_spans=k,r.robust_insert_highlighting_spans=l,r.robust_highlight_cell=m,n.__wrapped__=e,o.__wrapped__=e,r.set_config=g,r.get_formatted_cell=n,r.get_formatted_category_header=o,r.highlight_html=r._highlight_html,r.highlight_dom_node=h,r.highlight_jquery_el=i,r}var d="address,article,aside,blockquote,details,div,dl,fieldset,figure,footer,form,h1,h2,h3,h4,h5,h6,header,hgroup,hr,map,menu,nav,ol,p,pre,section,table,ul",e="[display=none],[display=block]",f=d+","+e;null==a.qlist.ext.objectSearch&&(a.qlist.ext.objectSearch={}),a.qlist.ext.objectSearch.get_highlighter=c}(jQuery),function(a){"use strict";function b(){b.prototype.__constructor__.apply(this,arguments)}function c(c,d){return a.extend(new b(d),c)}function d(a){return a.search.case_insensitive?x:new b}function e(b,c,d,e){return a.extend({},e,{search_value_type:"row",search:n(b,c,d,a.proxy(e,"search"))})}function f(b,d,e){var f=a("<td>");return c({preprocess_query:e.preprocess_query,search:function(a,c){var g=b(f,d,a),h=e.search(g,c);return h&&(h.source=g),h},search_value_type:"row"})}function g(b,d){var e=b.config.categories_map;return c({preprocess_query:d.preprocess_query,search:function(b,c){var f,g;for(g in e)if(e.hasOwnProperty(g)&&a.inArray(b,e[g])>=0){f=g;break}var h=d.search(f,c);return h&&(h.source=f),h},search_value_type:"row"})}function h(b,c,d,e){return a.extend({},e,{search:n(b,c,d,a.proxy(e,"search")),search_value_type:"row_expansion",expansion_parent_getter:c.config.search.expansion.parent_getter,expansion_children_getter:c.config.search.expansion.children_getter})}function i(b,d,e,f){null==e&&(e=d+"_fn");var g,h,i,j,k,l,m=v({},b[e],!0);for(i in m)if(m.hasOwnProperty(i))for(j=m[i],g=0,h=j.length;g<h;g++)k=j[g],l={},l[d]=k,a.extend(l,f),j[g]=c(l);return m}function j(b,c,d){var e=a.Deferred();return null==c.tbody&&(c.tbody=b.find("table.qlist tbody")),k(b,c,d,e),e.promise()}function k(b,c,j,k){var l,n,o,p,w,x,y,z,A,B,C,D,E;if(l=c.state,n=c.config,A=l.search.current_query,o=l.search.current_query=j,p=c.tbody,y=a.Event("searching"),b.trigger(y,o),y.isDefaultPrevented())return void k.reject();if(!o)return l.search.current_results=null,A!==o&&(n.search.fast_update?(w=t(p),q(w),w.each(function(b,c){a(c).show()})):s(b,c)),void k.resolve();if(A===o)return void k.resolve();var F=d(n);if(x={},!n.search.disable_fallback_dom_search){var G=[b,c,p,F];x={__row__:[e.apply(null,G)]},n.search.expansion&&x.__row__.push(h.apply(null,G))}if(n.search.search_categories){for(E=u(n),C=0;C<E.length;C++)null!=n.format_fn[E[C]]?x[E[C]]=[f(n.format_fn[E[C]],E[C],F)]:x[E[C]]=[F];n.categories.length>0&&(x.__category_header=[g(c,F)])}for(x=v(x,c.config.search.search_obj,!0),B=[["search"],["search","search_row_fn",{search_value_type:"row"}],["rate"],["group"],["autocomplete_sync","autocomplete_fn"]],C=0,D=B.length;C<D;C++)x=v(x,i.apply(null,[n.search].concat(B[C])),!0);null!=l.search.current_search&&(l.search.current_search.cancel&&l.search.current_search.cancel(),l.search.current_search=null),l.search.current_results={},l.search.current_search=m(n.source,o,x).progress(function(b){a.extend(l.search.current_results,b)}).then(function(){var d=l.search.current_results;l.search.current_search=null,z=a.Event("search_complete"),b.trigger(z,d,o),n.search.fast_update?(w=t(p),q(w),w.each(function(b,c){var e=a(c),f=e.data("index");null==f&&(f=e.data("sourceIndex")),e.toggle(f in d)}),r(w)):s(b,c),k.resolve()},function(c){throw z=a.Event("search_complete"),b.trigger(z,l.search.current_results,o),c})}function l(b,c,d,e){null==e&&(e={});var f,g,h;f=e.begin,g=e.end,null==f&&(f=0),null==g&&(g=b.length);var i,j,k,l,m,n,o,p,q,r,s,t,u=function(a,b){h=j.search("row"===j.search_value_type?q:b,k,l,a),(h===!0||h.length>0)&&(r[a]=h,t++)},w=function(a){function c(a){var c=b.indexOf(a);c>=0&&!o[c]&&(o[c]={})}var d=j.expansion_parent_getter,e=j.expansion_children_getter,f=d.call(null,b,a)||null,g=e.call(null,b,a)||[];g.forEach(function(a){c(a)}),f&&c(f)};for(o={},i=d["*"]||[],n=0,m=i.length;n<m;n++)for(j=i[n],k=j.preprocess_query(c),l=f;l<g;l++)q=b[l],r={},t=0,a.each(q,u),t>0&&(o[l]=v(o[l]||{},r));for(i=d.__row__||[],n=0,m=i.length;n<m;n++)if(j=i[n],k=j.preprocess_query(c),"value"!==j.search_value_type)for(l=f;l<g;l++)q=b[l],r=j.search(q,k,l,"__row__"),a.isArray(r)&&r.length>0?(o[l]=v(o[l]||{},{__row__:r}),"row_expansion"===j.search_value_type&&w(q)):a.isEmptyObject(r)||(o[l]=v(o[l]||{},r),"row_expansion"===j.search_value_type&&w(q));for(p in d)if(d.hasOwnProperty(p)){if("*"===p||"__row__"===p)continue;for(i=d[p]||[],n=0,m=i.length;n<m;n++)for(j=i[n],k=j.preprocess_query(c),l=f;l<g;l++)q=b[l],r=j.search("row"===j.search_value_type?q:q[p],k,l,p),r.length>0&&(s={},s[p]=r,o[l]=v(o[l]||{},s))}return o}function m(b,c,d){function e(){try{var a=i;i+=y,i<f?(g.notify(l(b,c,d,{begin:a,end:Math.min(i,f)})),h=setTimeout(e,z)):(g.notify(l(b,c,d,{begin:a})),g.resolve(f))}catch(a){g.reject(a)}}var f=b.length,g=a.Deferred(),h=null,i=0;return h=setTimeout(e,0),g.promise({cancel:function(){clearTimeout(h),g.reject(new Error("Search cancelled"))}})}function n(b,c,d,e){function f(a){var b,c;for(i.empty(),c=0;c<m;c++)b=j.clone(),b.append(k(b,l[c],a)),i.append(b);return i}function g(b,c,d){var g,i,j,k,p,q,r=h[d],s={},t=function(b){if(p=e(b,c,d,k),a.isArray(p)&&p.length>0)return p.source=b,s[k]=p,!1};for(null==r&&(r=f(b)),g=r.children("td"),j=0;j<m;j++)k=l[j],o.test(""+n.column_map[k].class)||(i=g.eq(j),i.find("."+n.search.highlight_class).contents().unwrap(),i.walkTextChunks(t),a.isArray(p)&&p.length>0||(q=i.text(),p=e(q,c,d,k),a.isArray(p)&&p.length>0&&(p.source=q,s[k]=p)));return s}var h=[];d.find("tr").filter(function(){var b=a(this);return null!=b.data("index")||null!=b.data("sourceIndex")}).each(function(b,c){var d=a(c),e=d.data("index");null==e&&(e=d.data("sourceIndex")),h[e]=d});var i=a("<tr>"),j=a("<td>"),k=c.fn.get_column_value,l=c.config.chosen_columns,m=l.length,n=c.config,o=/\bcategory\b/;return g}function o(a,b){if("string"!=typeof a)return[];var c=a.indexOf(b);return c===-1?[]:[[c,c+b.length]]}function p(a,b){if("string"!=typeof a)return[];var c=a.toLowerCase(),d=c.indexOf(b);return d===-1?[]:[[d,d+b.length]]}function q(a){var b=a.first(),c=a.filter(":visible:first"),d=c.find("td");c.is(b)||(b.find("td").width(function(a){return d.eq(a).width()}),c.find("td").width(""))}function r(a){var b=a.first(),c=a.filter(":visible:first");if(!c.is(b)){var d=b.find("td");c.find("td").width(function(a){return d.eq(a).width()})}}function s(b,c,d){b.one("qlist_load_that",function(){"function"===a.type(d)&&d()}),window.setTimeout(c.fn.qlistRefreshTable,5)}function t(b){return b.find("tr").filter(function(){var b=a(this);return null!=b.data("index")||null!=b.data("sourceIndex")})}function u(b){var c=a.map(b.columns,function(b){var c=(b.class||"").split(/\s+/);if(a.inArray("category",c)>=0)return b.selector});return c.concat(b.sections)}var v=window.fweb.util.objects.extend_merge;b.prototype={constructor:b,__constructor__:function(){},preprocess_query:function(a){return a},search:o,search_value_type:"value",rate:function(a,b,c,d){return+(d.length>0)},group:function(b,c,d,e){var f=[];return a.each(e,function(b,c){a.isArray(c)&&c.length>0&&f.append(b)}),f},autocomplete:function(a,b){var c=a.term;b(this.autocomplete_sync(c))},autocomplete_sync:function(){return[]}};var w,x=c({preprocess_query:function(a){return(""+a).toLowerCase()},search:p}),y=50,z=10,A="search",B=a.qlist.ext.objectSearch.get_highlighter;w=a.qlist.ext.objectSearch={depends:[],config_path:A,managed:!0,defaults:{enabled:!0,search_categories:!0,highlight:!0,highlight_color:"yellow",highlight_class:"search-highlight",fast_update:!1,case_insensitive:!0,autocomplete:!1,auto_async:!0,force_async:!1,group_order:[],focus_on_document_esc:!0,search_obj:{},search_obj_factory:{},search_fn:{},search_row_fn:{},rate_fn:{},group_fn:{},autocomplete_fn:{},strict_columns:{},disable_fallback_dom_search:!1},postinit:function(a,b){var c,e;return c=b.core.config,c.search.default_search_obj=d(c),e=b.core.state.search,null==e&&(e=b.core.state.search={}),{config:c.search,state:e}},get_formatted_cell:function(a,b,c){var d=b.config.search;return d.highlight?B(a,b,c).get_formatted_cell:c},get_formatted_category_header:function(a,b,c){var d=b.config.search;return d.highlight?B(a,b,c).get_formatted_category_header:c},get_filter_fn:function(b,c,d){function e(b,c){return(null==g||a.inArray(b,f)in g)&&d(b,c)}var f=c.config.source;if(null==c.state||null==c.state.search)return d;var g=c.state.search.current_results;return e},commands:{search:function(a,b,c){return j(a,b,c)}}},a.extend(a.qlist.ext.objectSearch,{SearchObject:b,declare:c,caseInsensitiveSearchObject:x,domSearchObjectFactory:e,get_highlighter:B})}(jQuery),function(a){var b,c=function(a,b){var c=null;return a.some(function(a){for(var d in b)if(b[d]!==a[d])return!1;return c=a,!0}),c},d=a.qlist._ext.resolve_config;a.qlist.ext.filterHighlight={staticDepends:["objectSearch"],depends:[],config_path:b="column_filters.highlight",managed:!0,defaults:{enabled:!1,highlight_color:null,highlight_class:"filter-highlight"},core_defaults:{},get_formatted_cell:function(e,f,g){var h,i,j,k;return h=f.fn.get_filter_settings(),i=a.qlist.ext.objectSearch.get_highlighter,j=i(e,f,g),j.set_config(d(f.config,b)),k=a.qlist.ext.objectSearch.caseInsensitiveSearchObject,function(b,d,e){var f,i,l,m=g(b,d,e),n=e[d];return"number"===a.type(n)&&(n=""+n),f=c(h,{id:d}),null!=f?(i=[],a.each(f.value,function(b,c){a.each(f.logic.OR||"string"===f.logic.search?[c]:c.split(/"([^\"]*)"|'([^']*)'|\s/).filter(function(a){return null!=a&&a.trim()}),function(b,c){a.merge(i,k.search(n,k.preprocess_query(c)))})}),i.length<1&&"string"===a.type(n)&&(l=[0,null],l.source=n,i.push(l)),j.robust_highlight_cell(i,m,n,b)):m}}}}(jQuery),function(a){a(this)}.call(this,function(a){"use strict";function b(a,b,c,d){this.format_item=c.format_item,this.format_requires_key=c.requires_key,this.format_fallback=c.format_fallback,this.selective_formatting=void 0!==this.format_requires_key&&"function"==typeof this.format_fallback,this.config=i(b.core.config,l),this.core_config=b.core.config,this._count=c.max||this.config.max,this.count_selector=c.display_count,this.count_format_fn=null,this.count_template=e.validator.format(c.count_template||'<div class="cell-collection-count">{0} '+e.getInfo("members")+"</div>"),this.count_requires_key=c.count_requires_key,this._selector=d;var f;this.getCollection=null!=(f=c.source_fn)?f:null!=(f=this.data_selector=c.selector)?function(a,b,c){return c[f]}:function(a,b,c){return c[b.selector]}}function c(a,b){this.$ql=a,this.internal=b,this.formatters={},this.config=i(b.core.config,l)}function d(a){var b=i(a.core.config,l)._instance;return b.setupExpansionClick(),b}var e=a.jQuery,f=(a.fweb,a.fweb.util),g=(a.setCookie,a.getCookie,a.removeCookie,e.qlist.ext.objectSearch.declare),h="cell-collection",i=e.qlist._ext.resolve_config,j=20,k={};k._item=e.validator.format('<div class="cell-collection-member">{0}</div>'),k.item=function(a){return k._item.call(this,a)},k.itemList=function(a,b,c,d,e){var f,g,h,i,j,l='<div class="flex-wrap">';for(f=d,g=c.length,h=null!=e?Math.min(g,e):g;f<h&&(i=c[f],!0);++f)l+=k.item(a.format_item_highlighted(b.td,b.col,i,b.sourceIndex,null==(j=b.filteredIndicies)?f:j[f]));return l+="</div>"},k.j2translate=function(a){var b=/\{% *lang +"([a-zA-Z_\-]+)" *%\}/g;return a.replace(b,function(a,b){return e.getInfo(b)})},k._anchor_display_more='{% lang "display_more" %}',k.anchor_display_more=k.j2translate(k._anchor_display_more),k.placeholder=e.validator.format(k.j2translate('<label class="cell-collection-expand"><button type="button" class="compact-visual-toggle"></button>'+k._anchor_display_more+' {% lang "cell_collection_amounts" %}</label>')),k.placeholder_filtered=e.validator.format(k.j2translate('<div class="cell-collection-filtered">{% lang "cell_collection_filtered" %}</div>')),b.prototype.type=h,b.prototype.format_fn=function(a,b,c){var d=b.selector;if(null===a)return this.getCollection(null,b,c);if(this.selective_formatting&&void 0===c[this.format_requires_key])return this.format_fallback(a,b,c);var f=e(a),g=f.closest("tr").data("sourceIndex"),h=this.getCollection(g,b,c),i=this.filterCollection(h,d,g),j=i[0],l=i[1],m=j!==h&&j.length!=h.length,n=k.itemList(this,{td:a,col:b,row:c,sourceIndex:g,filteredIndicies:l},j,0,this._count),o=j.length;return o>this._count&&(n+=k.placeholder()(o-this._count,o),n+='<div class="cell-collection-expansion" style="display: none;">'+k.itemList(this,{td:f,col:{selector:d},row:c,sourceIndex:g,filteredIndicies:l},j,this._count)+"</div>"),m&&(n+=k.placeholder_filtered()(h.length)),n},b.format_item_highlighted=function(a,b,c,d){return this.format_item(a,b,c)},b.prototype.filterCollection=function(a){return[a]},b.prototype.getCollectionLength=function(a,b,c){var d=e(a).closest("tr").data("sourceIndex"),f=this.getCollection(d,{selector:this._selector},c);if(null!=f)return f.length},b.prototype.formatCount=function(a,b,c){return this.count_template(this.getCollectionLength(a,b,c),$j.getInfo(this.core_config.column_map[this._selector].lang_key))},b.prototype.transformCountFormatter=function(a,b){if("string"!==e.type(this.count_selector))return!1;var c=this,d=a[this.count_selector]||a["*"];return b[this.count_selector]=this.count_format_fn=function(a,b,e){var f=d.apply(this,arguments),g=c.selective_formatting&&void 0===e[c.format_requires_key]||void 0!==c.count_requires_key&&void 0===e[c.count_requires_key];return g||(f+=c.formatCount(a,b,e)),f},this.count_format_fn.__wraps__=d,!0},c.prototype.transformFormatters=function(){Object.keys(this.formatters).length>0&&(window.console||{log:e.noop}).log("WARNING: reinitializing CellCollectionExtension formatters"),this.formatters={};var a={},b=this;e.each(this.internal.core.config.format_fn,function(c,d){var f;e.isPlainObject(d)&&d.type===h&&(f=b.newFormatter(c,d),a[c]=e.proxy(f,"format_fn"),a[c].context=f,f.transformCountFormatter(b.internal.core.config.format_fn,a))}),e.extend(this.internal.core.config.format_fn,a)},c.prototype.setupExpansionClick=function(){var a=this.$ql.find("label.cell-collection-expand"),b=a.find("button"),c=function(a){a.stopPropagation()};a.off("click").on("click",c),a.off("dblclick").on("dblclick",c),b.off("dblclick").on("dblclick",c),b.off("click").on("click",function(a){var b=e(this),c=!b.hasClass("active");b.toggleClass("active",c),b.closest("td").find(".cell-collection-expansion").toggle(c),a.stopPropagation()})},c.prototype.newFormatter=function(a,c){var d=new b(this.$ql,this.internal,c,a);return this.formatters[a]=d,d};var l;e.qlist.ext.cellCollection={depends:[],config_path:l="options.cell_collection_formatter",managed:!0,defaults:{_instance:null,enabled:!1,max:j},commands:{getCellCollectionFormatter:function(a,b,c){var d=i(b.config,l)._instance;return d.formatters[c]}},postconfigure:function(a,b){var d=i(b.core.config,l);return d._instance=d._instance||new c(a,b),d._instance.transformFormatters(),d._instance},postload:function(a,b){return d(b)},postpaging:function(a,b){return d(b)}};var m=e.qlist.ext.objectSearch.config_path;b.prototype.getSearchState=function(){var a=this.config._instance.$ql.data("qlist_state");if(null!=a)return i(a,m)},b.prototype.getOwnSearchResults=function(a,b){var c=this.getSearchState();if(null==c||null==c.current_results||null==c.current_results[b]||null==c.current_results[b][a])return null;var d;return e.each(c.current_results[b][a],function(a,b){if(b._is_collection_result)return d=b,!1}),d||null},b.prototype.filterCollection=function(a,b,c){var d=this.getOwnSearchResults(b,c);if(null==d)return[a,null];var f=0,g=[],h=e.grep(a,function(a,b){var c=b in d;return c&&(g[f]=b,f++),c});return[h,g]},b.prototype.newSearchObject=function(){var a=this,b=e.qlist.ext.objectSearch.caseInsensitiveSearchObject,c=function(c,d,e,f){var g,h,i,j,k,l={_is_collection_result:!0},m=!1;for(h=Array.isArray(c)?c.length:0,g=0;g<h;++g)i=c[g],k=a.format_item(null,{selector:f},i),j=b.search(k,d,e,f),j&&j.length>0&&(m=!0,j.source=k,l[g]=j);return m?[l]:[]},d=g({preprocess_query:b.preprocess_query,search:c});return d},c.prototype.extendSearchObject=function(){if(null==this._searchObj){var a,b,c={};for(var d in this.formatters)this.formatters.hasOwnProperty(d)&&(a=this.formatters[d],null==(b=c[d])&&(b=c[d]=[]),b.push(a.newSearchObject()));this._searchObj=c,f.objects.extend_merge(i(this.internal.core.config,m).search_obj,c)}},b.prototype.isHighlightingEnabled=function(){return i(this.config._instance.$ql.data("config"),m).highlight},b.prototype.format_item_highlighted=function(a,b,c,d,e){var f=this.format_item(a,b,c);if(!this.isHighlightingEnabled())return f;var g=this.getOwnSearchResults(b.selector,d);return null==g?f:this.config._instance.highlighter.robust_insert_highlighting_spans(g[e],f,f)},c.prototype.initHighlighter=function(){this.highlighter=e.qlist.ext.objectSearch.get_highlighter(this.$ql,this.internal.core,null)},e.qlist.ext.cellCollectionSearch={depends:["cellCollection","objectSearch"],config_path:l,managed:"auto",postconfigure:function(a,b){var c=b.cellCollection;c.extendSearchObject(),c.initHighlighter()}}}),function(a,b){b(jQuery)}(this,function(a){a.qlist.ext.emptyFilteredResultsEvent={config_path:"emptyFilteredResultsEvent",managed:!0,defaults:{enabled:!1},postload:function(b,c){var d=c.core,e=d.fn.get_filter_settings();if(0!==e.length){var f=d.fn.get_complete_filter_fn(b,d.config,d.state);if(0===d.fn.get_filtered_lines(f)){var g=a.Event("emptyFilteredResults");b.trigger(g,[e,{sourceLength:d.config.source.length}])}}}}}),function(a){"use strict";var b=function(b,c){return a.getJSON("/api/v2/cmdb/"+b+"/"+c).then(function(a){return a.results})},c={resize:a.debounce(0,function(){a(window).trigger("resize")})},d=function(){var a={};return function(c,d){Object.keys(a).length?d(a[c]):b("firewall","internet-service").then(function(b){b.forEach(function(b){a[b.id]=b}),d(a[c])})}}(),e=function(){function b(b){return a.ajax({url:d+b,cache:!1,dataType:"json",data:c})}var c={format:"name|alias|description|type"},d="/api/v2/cmdb/system/interface/",e={};return function(a,c){if(a)return e[a]||(e[a]=b(a)),e[a].then(function(b){e[a].result=b.results[0],c(b.results[0])},function(){e[a].result={name:a},c(e[a])}),e[a].result}}(),f=function(a,b,d){var f=d[b.selector];if(a){var g;if(e(f,function(b){g=fweb.util.interface.interfaceFormatFn(f,b,!0),a.html(g),c.resize()}),g)return""}return f},g={name:function(a,b,c){var d=c[b.selector];if(!a)return d;if(!c.q_class)return escapeHTML(d);var e;return e=c.q_class.indexOf("profile")>0?'<span class="'+c.q_class+'"></span>':'<f-icon class="'+c.q_class+'"></f-icon>',e+"<span>"+escapeHTML(d)+"</span>"},comment:function(a,b,c){var d=c[b.selector];return a?fweb.util.formatters.truncate_comment(d):d},q_ref:function(a,b,c){var d=c[b.selector];return null==d?d="":a&&(d='<a class="qlist_ref" href="#">'+d+"</a>"),d},q_status:function(a,b,c){var d=c[b.selector];if(a){var e=1==d?"up":"down";return'<a class="a_sprite tool_'+e+'"></a>'}},cloudapp:function(a,b,e){var f=e[b.selector],g=f,h=function(b){g=b?b.name:g,a&&(a.find("[data-cloudapp-id="+f+"]>span").text(g),c.resize())};return d(f,h),'<div data-cloudapp-id="'+f+'"><f-icon class="fa-cloud"></f-icon><span>'+g+"</span></div>"},policyid:function(a,b,c){function d(b){function d(c){var d=escapeHTML(b.name||f);if(!g){var e=c.url;d='<a href="'+e+'" target="_top">'+d+"</a>",b.comments&&(d='<span title="'+escapeHTML(b.comments)+'">'+d+"</span>")}b.name&&(d=f+" ("+d+")"),a.html(d)}a&&fweb.util.policy.getMatchingPolicyListUrl(e,c).then(d)}var e=b.selector,f=c[e],g=fweb.util.policy.disablePolicyLink(c,e);if(fweb.util.policy.disableParsePolicy(c))return f;if(c.csfPath)return c.policyname?f+"("+c.policyname+")":f;var h=fweb.util.policy.policyMetaLookup(f,c.policytype,c.subtype,d);return a?"":f+(h?" ("+h+")":"")},policytype:function(b,c,d){var e=d.policytype||"policy";return a.getInfo("Firewall::policytype."+e)},srcintf:f,dstintf:f,interface:f,"*":function(b,c,d){var e=c.selector,f=d[e];if(!b)return f;var g=escapeHTML;if(a.isArray(f)&&f.length>0){var h='<ul class="qlist_obj_list"><li>';
return h+a.map(f,function(b){if(a.isPlainObject(b)&&"name"in b){var c=b["css-class"]||"";return'<span class="'+c+'">'+g(b.name)+"</span>"}return"<span>"+g(b)+"</span>"}).join("</li><li>")+"</li></ul>"}return g(f)}};g.comments=g.description=g.comment,a.extend(a.qlist.format_fn,g)}(jQuery),function(a,b){"use strict";a.qlist.menu_items={add_policy_block_items:function(c,d,e){function f(d){function e(b){return{name:a.getInfo("Policy::Block::"+g+" {ADDRESS}",[b[d]])}}function f(b){return{cls:"icon_fw addr_range_0",type:"iprange","start-ip":b[d],"end-ip":b[d],name:a.getInfo("Policy::Block::"+g+" {ADDRESS}",[b[d]])}}var g=c?c[d]:d,l="/p/firewall/policy";k["block_"+d]={url:"javascript: void 0",class:"tool_deny",label:a.getInfo("Policy::Block::"+g),handler:j.reportExceptions(function(c){function j(b){fweb_require(["jquery.validate.rules"],function(c){a(b.target).find("form").validate({rules:c.firewall["address"+r]})})}function k(){var b="Policy::BlockName::"+g+r,c=a.getInfo(b);s.push({selector:"name",value:c});var d={key:"name",pattern:c};CMDB.fetch("firewall","policy"+r,d).then(m,n)}function m(a){var b=a.results[0]?a.results[0].policyid+"/":"",c="block="+encodeURIComponent(JSON.stringify(s));r=r?"/"+r:"",top.main?top.main.location.href=l+r+"/edit/"+b+"?"+c:top.location.href=l+r+"/edit/"+b+"?"+c}function n(a){b.log(a),Notify.post(JSON.stringify(a),"error")}var o=i(c,d),p=RegExp.prototype.test.bind(/:/);if(o.length>0){var q=o.map(h(d)),r=p(q[0])?"6":"";if(r&&!q.every(p)||!r&&q.some(p))return void require(["notify"],function(b){b.post(a.getInfo("Unable to create a policy with mixed ipv4 and ipv6 addresses"),"error")});var s=[{path:"firewall",name:"address"+r,selector:o.length>1?void 0:g,values:o.map(f)},{selector:"srcaddr"===g?"dstaddr":"srcaddr",values:["all"]},{selector:"service",value:"ALL"},{selector:"paction",value:"deny"},{selector:"srcintf",values:["any"]},{selector:"dstintf",values:["any"]}],t=a.Deferred(),u="block_policy_create_name_address_group_dlg",v="<style>#"+u+" input { width: 100% }</style>",w=a.getInfo("Enter a descriptive name for this Address Group"),x=v+'<form><div id="'+u+'"><h4>'+w+'</h4><input class="addr_grp_name" name="name"></div></form>';if(o.length>1){var y=b.dialog(x,{title:a.getInfo("Address Group Name"),open:j,buttons:[{text:a.getInfo("ok"),click:function(){return!!a(y[0]).find("form").validate().valid()&&(t.resolve(y.find(".addr_grp_name").val()),void y.dialog("close"))}},{text:a.getInfo("cancel"),click:function(){t.reject(),y.dialog("close")}}]});t.then(function(a){s.push({path:"firewall",name:"addrgrp"+r,selector:g,values:[{cls:"icon_fw addr_grp_0",name:a,member:o.map(e)}]})})}else t.resolve();t.then(k)}})}}function g(d){function e(b){return function(c){var d=b===c?' selected="selected"':"";return'<option value="'+l[c]+'" '+d+">"+a.getInfo(c)+"</option>"}}function f(b,c){"error"===b.status?g(c,b.error):require(["notify"],function(b){b.post(a.getInfo("Source has been quarantined"))})}function g(a,b){require(["notify"],function(a){a.post(b,"error")})}var l={seconds:1,minutes:60,hours:3600,days:86400},m='data-enable-if-checked="! [name=quarantine_permanent]"',n=b.util.dom.renderTemplate(['<form id="{{ id }}">','<style type="text/css" rel="stylesheet">',"#{{ id }} .container {","   display: inline-flex; flex-direction: column }","#{{ id }} div { margin: 0.5ex 0; display: flex; ","    justify-content: flex-end;","}","#{{ id }} { text-align: center }","#{{ id }} .quarantine_duration { width: 6em }","#{{ id }} .{{ perm }} label, #{{ id }} .{{ perm }} input {","    vertical-align: middle }","#{{ id }} p {","   width: 70vw;","   max-width: 20em;","   text-align: left;","}","</style>","<p>{{ message }}</p>",'<div class="container">','  <div><input type="number" min="1" name="quarantine_duration" ','    class="depends quarantine_duration number" {{ dep }} value="30">','    <select name="multiplier" class="depends" {{ dep }}>',"    {{ opts }}","    </select></div>",'  <div class="{{ perm }}"><label for="{{ perm }}">{{ ban }}</label>','  <input type="checkbox" name="{{ perm }}" id="{{ perm }}">',"</div></div>","</form>"].join("\n"),{ban:a.getInfo("Permanent Ban"),message:a.getInfo("An IP ban will be created..."),dep:m,opts:Object.keys(l).map(e("minutes")).join("\n"),perm:"quarantine_permanent",id:"quarantine_menu_dialog"}),o=c?c[d]:d;"srcaddr"===o&&(k["quarantine_"+d]={url:"javascript: void 0",class:"tool_quarantine",label:a.getInfo("Quarantine Source"),handler:j.reportExceptions(function(c){var e,j,k=i(c,d);require(["jquery.ui_dependencies","ajax_setup"],function(){function c(b){a(b.target).ui_dependencies()}function i(){function b(a,b){return a[b.name]=b.value,a}var c=e.find("form").serializeArray().reduce(b,{});c.quarantine_duration&&(j.expiry=c.quarantine_duration*c.multiplier),l(),a.ajax({url:"/api/v2/monitor/user/banned/add_users/",type:"POST",dataType:"json",data:JSON.stringify(j)}).then(f,g)}function l(){e.dialog("close").remove()}k.length>0&&(j={ip_addresses:k.map(h(d))},e=b.dialog(n,{title:a.getInfo("Quarantine Duration"),open:c,buttons:[{text:a.getInfo("ok"),click:i},{text:a.getInfo("cancel"),click:l}]}))})})})}function h(a){return function(b){return b[a]}}function i(b,c){function e(a){var b={};return function(c){return!b[c[a]]&&(b[c[a]]=c,!0)}}var f=d&&d.source||a(b.cur_elem).closest(".qlist-container").data("config").source;return b.get_checked_rows().get().map(function(b){return f[a(b).data("sourceIndex")]}).filter(e(c))}var j=b.util.events,k=d&&d.menu_items||{},l=Object.keys(c);return e&&"quarantine"!==e||l.forEach(g),e&&"block"!==e||l.forEach(f),k}}}(jQuery,fweb);