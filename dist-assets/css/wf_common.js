function getTimeStrFromSec(seconds){var fm=[],hr=Math.floor(seconds/3600),min=Math.floor((seconds-3600*hr)/60),sec=seconds%60;return hr&&(fm.push(hr),fm.push("h")),min&&(fm.push(min),fm.push("min")),sec&&(fm.push(sec),fm.push("sec")),fm.join(" ")}function getHexNum(num){var hexNum=num.toString(16).toUpperCase();return 1==hexNum.length?"0"+hexNum:hexNum}function tree_node_selected(tree,leaf){return tree.get_selected()}function getGrpAction(childrenActions){var allSameValue=!Array.prototype.some.call(childrenActions,function(value,index,array){return value!==array[0]});return allSameValue?childrenActions[0]:"all"}function getMaxTimeUnit(seconds){"use strict";for(var result,unit,limit,i=0,DEFAULT_UNIT="m";!result&&i<getMaxTimeUnit.TIME_UNITS.length;)unit=getMaxTimeUnit.TIME_UNITS[i],limit=getMaxTimeUnit.TIME_LIMITS[unit],seconds>limit&&seconds%limit===0&&(result=unit),i++;return result||DEFAULT_UNIT}function IdentityGroup(id,name){this.id=id,this.name=name}function IdentityCategory(opts){this.id="",this.name="",this.actionCode="allow",this.mouseOverTip=this.getTip(),$j.extend(this,opts)}function FtgdQuota(id,data){"use strict";this.id=id,this.type=data.type,this.dur=data.dur,this.value=data.value,this.unit=data.unit,this.cat=[],this.catHex=[]}function QuotaCat(cat,grpId){this.category=cat,this.grpId=grpId}function WebfFtgd(ratingMap){var nodeTypes={allow:{icon:actionIcons.allow},monitor:{icon:actionIcons.monitor},block:{icon:actionIcons.block},authenticate:{icon:actionIcons.authenticate},disable:{icon:actionIcons.disable},warning:{icon:actionIcons.warning},all:{icon:actionIcons.all}};this.divID="",this.tree=null,this.treeData=[],this.treeSettings={core:{data:{},themes:{dots:!0,icons:!0}},types:nodeTypes,checkbox:{keep_selected_style:!0},plugins:["themes","json_data","types","checkbox"]},this.catsIndex={},this.grps=[],this.cats=[],this.quota=[],this.maxQuotaId=0,this.refreshQuotaQlistFn=null,this.grpNodes4Refresh=[],this.catNodes4Refresh=[],this.quotaIds4Refresh=[],this.quotaWindowSize={height:330,width:600},this.originalCats={},this.categoryRatingMap=ratingMap||{}}var SPACECHR=" ";getMaxTimeUnit.TIME_UNITS=["h","m","s"],getMaxTimeUnit.TIME_LIMITS={h:3600,m:60,s:1},IdentityGroup.prototype={setTreeData:function(members){this.text=this.name,this.id=parseInt(this.id,10)+"g",this.li_attr={id:this.id};var childrenAction=(members||[]).map(function(val){return val.actionCode||val.type}),grpAction=getGrpAction(childrenAction);this.type=this.li_attr.rel=grpAction,this.children=members},getId:function(){return parseInt(this.id,10)}},IdentityCategory.prototype={getTipKey:function(){return $j.getInfo("ftgd_"+this.actionCode)},setTreeData:function(grpid,checked){this.text=this.name,this.type=this.actionCode,this.li_attr={id:this.id,grpid:parseInt(grpid,10)+"g",rel:this.actionCode,class:checked?"fa-flag-o":"",title:this.mouseOverTip,children:!1,state:"open"}},getTreeData:function(grpId,checked){return{id:this.id,text:this.name,type:this.actionCode,li_attr:{rel:this.actionCode,grpid:grpId,title:this.mouseOverTip},state:{checked:checked,selected:checked},children:!1}},getTip:function(){var tip=[];return tip.push(this.getTipKey()),this.usrgrp&&this.usrgrp.length?(tip.push(" - "),tip.push($j.getInfo("ftgd_usrgrp")),tip.push(SPACECHR),tip.push(this.usrgrp.join(", "))):this.dur&&(tip.push(" - "),tip.push($j.getInfo("ftgd_interval")),tip.push(SPACECHR),tip.push(getTimeStrFromSec(this.dur))),tip.join("")},changeActionWithAddi:function(act,dur,usrgrp){this.actionCode=act,this.dur=dur,this.usrgrp=usrgrp,this.mouseOverTip=this.getTip()},submit:function(id,form){if(appendFormField(form,"catId"+id,this.id),appendFormField(form,"action"+id,this.actionCode),("warning"==this.actionCode||"authenticate"==this.actionCode)&&(this.dur&&appendFormField(form,"warn"+id,this.dur),"authenticate"==this.actionCode&&this.usrgrp)){var value=$j.extend([],this.usrgrp).join("#");appendFormField(form,"usrgrp"+id,value)}void 0!==this.rmsg&&appendFormField(form,"rmsg"+id,this.rmsg)},toJSON:function(){var obj={catId:this.id,action:this.actionCode};return"warning"!=this.actionCode&&"authenticate"!=this.actionCode||(obj.warn=this.dur,"authenticate"==this.actionCode&&this.usrgrp&&(this.usrgrp.join=Array.prototype.join,obj.usrgrp=this.usrgrp.join("#"))),void 0!==this.rmsg&&(obj.rmsg=this.rmsg),obj}},FtgdQuota.prototype={toJSON:function(){"use strict";var obj={id:this.id};return void 0!==this.qtState&&this.qtState===PROFILE_DEL&&(obj.st=this.qtState),this.catHex&&(obj.cat=this.catHex.join("")),this.type&&(obj.type=this.type),this.dur&&(obj.dur=this.dur),this.value&&(obj.value=this.value),this.unit&&(obj.unit=this.unit),obj}};var actionIcons={allow:"utm_actions action_allow",monitor:"utm_actions action_monitor",block:"utm_actions action_block",all:"utm_actions action_all",warning:"utm_actions action_warning",authenticate:"utm_actions action_authenticate",disable:"utm_actions action_disable"};WebfFtgd.prototype={init:function(grps,cats,actions,options,refreshQuotaQlistFn){this.originalCats=$.extend(!0,{},cats),this.setGrps(grps),this.setCats(cats,actions),this.refreshQuotaQlistFn=refreshQuotaQlistFn,(!options||options&&!options.noContextMenu)&&this.contextMenu(options&&options.dns),(!options||options&&!options.noSearch)&&this.searchOptions(),options&&(this.g_redir_url=options.g_redir_url,this.g_cat_action_url=options.g_cat_action_url,this.CL_GRP_LCAT=options.CL_GRP_LCAT)},makeTreeData:function(){var i,k,parent,members,grpId,treeData=[],curCatsInQuota=this.curCatsInQuota||[],map={};for(i=0;i<this.grps.length;i++){var children=[];parent=this.grps[i],grpId=parseInt(parent.id,10),members=this.cats[grpId],k=0,(members||[]).forEach(function(member){var id=member.id,checked=$j.inArray(id,curCatsInQuota)>-1;child=member.getTreeData(grpId,checked),map[id]={grp:grpId,mem:k},children.push(child),k++}),parent.setTreeData(children),treeData.push(parent)}this.catsIndex=map,this.treeData=treeData,$j.extend(!0,this.treeSettings,{core:{data:treeData}})},searchOptions:function(){$j.extend(this.treeSettings,{search:{show_only_matches:!0,search_callback:function(searchStr,node){return searchStr===node.type}}}),this.treeSettings.plugins.push("search")},contextMenu:function(isDNS){function setAction(action){var inst=ftgdCat.tree,nodes=inst.get_checked()||inst.get_selected(),tmpCats=[],tmpGrps=[];nodes.forEach(function(nodeId){if(inst.set_type(nodeId,action),inst.is_leaf("#"+nodeId)){var grpId=inst.get_parent(nodeId),children=inst.get_node(grpId).children,childrenActions=children.map(function(val){return inst.get_node(val).type}),grpAction=getGrpAction(childrenActions);inst.set_type(grpId,grpAction),tmpCats.push(nodeId)}else{var children=inst.get_node(nodeId).children;inst.set_type(children,action),tmpGrps.push(nodeId)}}),ftgdCat.getNodes4Refresh(tmpCats,tmpGrps),ftgdCat.changeCatsAction(action)}function customMenu(node){function noActionCustom(nodeId){var type=inst.get_type(nodeId);return["warning","authenticate","block"].indexOf(type)===-1}function noActionBlock(nodeId){var grpId;if(inst.is_leaf(nodeId)){var selectedNode=inst.get_node("#"+nodeId);grpId=parseInt(selectedNode.li_attr.grpid,10)}else grpId=parseInt(nodeId,10);return grpId!==(ftgdCat.CL_GRP_LCAT||CL_GRP_LCAT)}if(!is_rw_admin)return[];var items={actionAllow:{id:"allow",label:$.getInfo("ftgd_allow"),icon:actionIcons.allow,separator_before:!1,separator_after:!1,action:function(data){setAction.call(this,data.item.id)}},actionBlock:{id:"block",label:$.getInfo("ftgd_block"),icon:actionIcons.block,action:function(data){setAction.call(this,data.item.id)}},actionMonitor:{id:"monitor",label:$.getInfo("ftgd_monitor"),icon:actionIcons.monitor,action:function(data){setAction.call(this,data.item.id)}},actionWarning:{id:"warning",label:$.getInfo("ftgd_warning"),icon:actionIcons.warning,action:function(data){setAction.call(this,data.item.id)}},actionAuthenticate:{id:"authenticate",label:$.getInfo("ftgd_authenticate"),icon:actionIcons.authenticate,action:function(data){setAction.call(this,data.item.id)}},actionDisable:{id:"disable",label:$.getInfo("disable"),icon:actionIcons.disable,action:function(data){setAction.call(this,data.item.id)}},actionCustom:{id:"custom",label:$.getInfo("ftgd_custom"),icon:actionIcons.all,action:function(data){ftgdCat.repmsg_dialog()}}},isSniffer="sniffer-profile"===$("#name").val()&&$("#name").is(":disabled");isSniffer&&delete items.actionBlock;var isFlowMode=$("#mode_flow").is(":checked");(isFlowMode||isDNS)&&(delete items.actionWarning,delete items.actionAuthenticate);var inst=this,selectedNodes=inst.get_selected();return(isDNS||selectedNodes.some(noActionCustom))&&delete items.actionCustom,selectedNodes.some(noActionBlock)&&delete items.actionDisable,items}var ftgdCat=this;$j.extend(this.treeSettings,{contextmenu:{select_node:!0,items:customMenu}}),this.treeSettings.plugins.push("contextmenu")},buildTree:function(divId){var ftgdCat=this;divId=divId||"treeDivCat",this.divID=divId,this.makeTreeData(),$j("#"+this.divID).jstree(this.treeSettings).on("before_open.jstree",function(e,data){data.node.children.forEach(function(nodeId){ftgdCat.refreshNode(nodeId)})}),this.treeSettings.plugins.indexOf("search")>-1&&$j("#"+this.divID).on("search.jstree",function(e,data){$j("#"+divId).toggle(data.res.length>0)}),this.tree=$j.jstree.reference("#"+this.divID),this.updateRatingOption()},updateRatingOption:function(){var $ratings=$('input[name="ratings"]');if($ratings.length){var rating=this.getRatingByCategories();$('input[name="ratings"][value="'+rating+'"]').prop("checked",!0)}},getRatingByCategories:function(){"use strict";function genKey(flags){return flags.join("_")}function genRatingActionMap(result,rating){var categoriesInRating=categoryMap[rating],action=Object.keys(categoriesInRating).reduce(genRatingAction,0);return result[rating]=action,result}function genRatingAction(previousAction,id){var category=catsAction[+id],currentAction=FLAG_CUSTOM;return category&&"block"===category.action?currentAction=FLAG_BLOCK:category&&"allow"!==category.action||(currentAction=FLAG_ALLOW),previousAction|currentAction}var FLAG_BLOCK=1,FLAG_ALLOW=2,FLAG_CUSTOM=3,searchKeys=["security-risk","G","PG-13","R"],ratingSearchMap=new Map([[genKey([FLAG_BLOCK,FLAG_ALLOW,FLAG_BLOCK,FLAG_BLOCK]),"G"],[genKey([FLAG_BLOCK,FLAG_ALLOW,FLAG_ALLOW,FLAG_BLOCK]),"PG-13"],[genKey([FLAG_BLOCK,FLAG_ALLOW,FLAG_ALLOW,FLAG_ALLOW]),"R"]]),categoryMap=this.categoryRatingMap,catsAction=this.getAllCategoryAction(),ratingActionMap=Object.keys(categoryMap).reduce(genRatingActionMap,{}),searchFlags=searchKeys.map(function(key){return ratingActionMap[key]});return ratingSearchMap.get(genKey(searchFlags))||"Custom"},getAllCategoryAction:function(){var result={};return Object.keys(this.cats).forEach(function(grpId){this.cats[grpId].forEach(function(category){result[category.id]={action:category.actionCode}})}.bind(this)),result},updateCategoryTreeByRating:function(selectedRating){function shouldBlockRating(rating){var allowedRatingMap={G:"G","PG-13":"G PG-13",R:"G PG-13 R"},allowedRatings=allowedRatingMap[selectedRating];return!allowedRatings.split(" ").includes(rating)}var updatedCategories=[];"Custom"!==selectedRating&&(Object.keys(this.categoryRatingMap).forEach(function(rating){var block=shouldBlockRating(rating);Object.keys(this.categoryRatingMap[rating]).forEach(function(id){updatedCategories[id]={action:block?"block":"allow"}})}.bind(this)),ftgdCat.refresh(updatedCategories))},refresh:function(actions){this.setCats(this.originalCats,actions),this.makeTreeData(),$("#"+this.divID).jstree(!0).settings.core.data=this.treeData,$("#"+this.divID).jstree(!0).refresh()},setMaxQuotaId:function(){this.maxQuotaId=Math.max.apply(Math,$j.map(this.quota,function(v){if(v)return v.id})),this.maxQuotaId<0&&(this.maxQuotaId=0)},submit:function(){var i,j,grpId,category,count=0,form=document.wf_prof_frm;for(i=0;i<this.grps.length;i++)for(grpId=this.grps[i].id,j=0;j<this.cats[grpId].length;j++)category=this.cats[grpId][j],"allow"!=category.actionCode&&category.submit(count++,form);appendFormField(form,"catCount",count),quota&&this.quotaSubmit(form)},quotaSubmit:function(form){var count=0;for(var i in this.quota)null!=this.quota[i]&&null!=this.quota[i].id&&(appendFormField(form,"qtId"+count,this.quota[i].id),"undefined"==typeof this.quota[i].qtState||this.quota[i].qtState!=PROFILE_DEL?(this.quota[i].catHex&&appendFormField(form,"qtCat"+count,this.quota[i].catHex.join("")),this.quota[i].dur&&appendFormField(form,"qtDur"+count,this.quota[i].dur),count++):(appendFormField(form,"qtSt"+count,this.quota[i].qtState),count++));appendFormField(form,"qtCount",count)},toJSON:function(){for(var catArr=[],quotaArr=[],i=0;i<this.grps.length;i++)for(var grpId=this.grps[i].getId(),j=0;j<this.cats[grpId].length;j++){var category=this.cats[grpId][j];"allow"!=category.actionCode&&catArr.push(category)}for(var i in this.quota)null!=this.quota[i]&&null!=this.quota[i].id&&quotaArr.push(this.quota[i]);var obj={categories:catArr};return quotaArr.length>0&&(obj.quota=quotaArr),obj},setGrps:function(grps){grps&&grps.length>0&&(this.grps=grps)},setCats:function(catArr,actionArr){if(this.grps&&catArr){this.cats=catArr;for(var i=0;i<this.grps.length;i++){var grpId=parseInt(this.grps[i].id,10);$j.each(this.cats[grpId],function(i,cat){if(actionArr[cat.id]){var act="allow",dur=null,usrgrp=null;act=actionArr[cat.id].action,actionArr[cat.id].warnDuration&&(dur=actionArr[cat.id].warnDuration),actionArr[cat.id].usrgrp&&(usrgrp=actionArr[cat.id].usrgrp),cat.rmsg=actionArr[cat.id].rmsg,cat.changeActionWithAddi(act,dur,usrgrp)}})}delete actionArr}},repmsg_dialog:function(){"undefined"==typeof ReplacementMessage&&$j.addScript("/"+fweb.CONFIG_GUI_NO+"/module_js/replacement_message.js");var tree=this.tree,nodes=tree_node_selected(tree),node=nodes&&nodes[0];if(node){var name=$j("#rmsg_group").val()||"web-filter-"+$j("#name").val(),msgdef={type:"utm",table:"fortiguard-wf"},cat=this.tree.is_leaf(node)?this.getCatById(node):this.cats[parseInt(node,10)][0];"authenticate"==cat.actionCode?msgdef.section="ftgd-warning":"block"==cat.actionCode?msgdef.section="ftgd-block":"warning"==cat.actionCode&&(msgdef.section="ftgd-warning");var config={type:"utm",name:name,table:"custom-message",section:cat.rmsg||cat.id,default:msgdef};ReplacementMessage.show(config).then(function(action){"reset"!==action&&$j("#rmsg_group").val(name),nodes.forEach(function(nodeId){var cat=ftgdCat.getCatById(nodeId);"reset"===action?delete cat.rmsg:["authenticate","block","warning"].indexOf(cat.actionCode)>-1&&(cat.rmsg=config.section),tree.is_leaf(nodeId)&&ftgdCat.refreshNode(nodeId)}),Notify.post("reset"===action?$j.getInfo("Replacement message was restored to default"):$j.getInfo("Customized replacement message was created"))})}},changeCatsAction:function(act){"all"!=act&&("warning"==act||"authenticate"==act?this.chgAction2WarnAuthen(act).then(function(){this.updateRatingOption()}.bind(this)):(this.chgAction2Else(act),this.updateRatingOption()))},chgAction2WarnAuthen:function(act){var url=this.g_cat_action_url||g_cat_action_url;return url+="?action="+act,url+="&redir=/success",fweb.util.slide.iframe(url)},transformAction:function(match,action,show_warn){for(var grpId,grps=this.getGrpsByAction(match),tree=this.tree,i=0;i<grps.length;i++)grpId=grps[i].getId(),$j.each(this.cats[grpId],function(i,cat){if(match.indexOf(cat.actionCode)!==-1){var act="block",dur=null,usrgrp=null;cat.changeActionWithAddi(act,dur,usrgrp),tree.set_type(cat.id,act)}});show_warn&&!this.warn_shown&&(this.warn_shown=!0,Notify.post($j.getInfo("warn_flow_av_mode"),"warning"))},chgAction2Else:function(act){function updateCats(){ftgdCat.updateCheckedObjSpriteClass(act)}var i,x,cats=[],ftgdCat=this,nodes=tree_node_selected(this.tree);if("block"!==act&&"allow"!==act)return updateCats();for(i=0;x=nodes[i];i++){var j,node=this.tree.get_node(x),grps=this.tree.is_leaf(x)?[node]:node.children.map(function(id){return ftgdCat.tree.get_node(id)});for(j=0;cat=grps[j];j++)if(void 0!==this.getCatQuotaIndex(cat.id)){var name=cat.text;$j.inArray(name,cats)<0&&cats.push(name)}}return cats.length?($j("#wf_quota").is(":visible")||$j("#enable-quota-toggle").click(),$j.confirm($j.getInfo("webfilter/profile/quota_remove").replace("%s",cats.join(", "))).done(updateCats)):void updateCats()},getNodes4Refresh:function(tmpCats,tmpGrps){tmpCats.length&&(this.catNodes4Refresh=tmpCats),tmpGrps.length&&(this.grpNodes4Refresh=tmpGrps)},getFirstSelectedCategory:function(){for(var node,grp,nodes=this.catNodes4Refresh,cat=nodes.length&&this.getCatById(nodes[0]),grps=this.grpNodes4Refresh,i=0;!cat&&(grp=grps[i]);i++){var children=this.tree.get_children(grp);if(children.length){for(var j=0;node=children[j];j++)if(this.tree.is_selected(node)){cat=this.getCatById(node);break}}else cat=null}return cat},getGrpIdByCatId:function(id){var node=this.tree.get_node(id);return node.parent},updateCheckedObjSpriteClass:function(act,dur,usrgrp){var i,nodeId,category;for(i=0;i<this.catNodes4Refresh.length;i++)if(nodeId=this.catNodes4Refresh[i],category=this.getCatById(nodeId)){var j=this.removeCatFromQuota(nodeId,act);j&&(this.quotaIds4Refresh[j]=j-0),category.changeActionWithAddi(act,dur,usrgrp),this.refreshNode(nodeId)}this.tree.deselect_all(),this.catNodes4Refresh.length=0,this.grpNodes4Refresh.length=0,this.quotaIds4Refresh.length&&$j.isFunction(this.refreshQuotaQlistFn)&&this.refreshQuotaQlistFn()},getCatQuotaIndex:function(catId){var x,quotas=this.quota;for(x in quotas)if($j.inArray(parseInt(catId,10),quotas[x].cat)>=0)return x},removeCatFromQuota:function(catId,newAction){var idx;return"allow"==newAction||"block"==newAction?(idx=this.getCatQuotaIndex(catId),void 0!==idx&&this.removeCatFromQuotaByIdx(idx,$j.inArray(parseInt(catId),this.quota[idx].cat)),idx):null},refreshNode:function(nodeId){var $node=$j("#"+nodeId),cat=this.getCatById(nodeId);cat&&($node.attr("title",cat.mouseOverTip),cat.rmsg?$node.children("a").find(".fa-pencil-square-o").length||$node.children("a").append('<f-icon class="fa-pencil-square-o" title="'+$j.getInfo("Edit Replacement Message")+'"></f-icon>'):$node.children("a").find(".fa-pencil-square-o").remove())},filterCatsByAction:function(search){"all"===search?(this.tree.clear_search(),$j("#"+this.divID).show()):this.tree.search(search),this.tree.close_all()},getGrpsByAction:function(act){var i,j,category,grpId,grps=[];for(i=0;i<this.grps.length;i++)for(grpId=this.grps[i].getId(),j=0;j<this.cats[grpId].length;j++)if(category=this.cats[grpId][j],$j.inArray(category.actionCode,act)>-1){grps.push(this.grps[i]);break}return grps},getQuotaRowData:function(quota){var data={};return quota.cat&&(data.category=this.getCatsNameStr(quota.cat)),"time"===quota.type?data.duration=getTimeStrFromSec(quota.dur):data.duration=quota.value+" "+quota.unit,data.id=quota.id,data},getCatsNameStr:function(catIdArr){for(var names=[],i=0;i<catIdArr.length;i++)names.push(this.getCatNameById(catIdArr[i]));return names.join(", ")},getCatNameById:function(catId){var cat=this.getCatById(catId);return cat&&cat.name},getCatById:function(catId){catId=parseInt(catId,10);var idx=this.catsIndex[catId];return idx?this.cats[idx.grp][idx.mem]:null},getActionByCatId:function(catId){var cat=this.getCatById(catId);return cat&&cat.actionCode},updateHttpsDeepScan:function(exemptSsl){for(var i=0;i<exemptSsl.length;i++)switch(exemptSsl[i]){case deepSslInspectCat.BANKING:case deepSslInspectCat.PERSONAL_PRIVACY:case deepSslInspectCat.HEALTH_CARE:$j(":checkbox[id^=exemptSsl_][value="+exemptSsl[i]+"]").prop("checked",!0);break;default:i++}},removeCatFromQuotaByIdx:function(qId,idx){this.quota[qId].cat.splice(idx,1),this.quota[qId].catHex.splice(idx,1)},eligCat4QuotaByAct:function(act){return"monitor"==act||"warning"==act||"authenticate"==act},catInOtherQuota:function(catId,curQuotaId){for(var i in this.quota)if(this.quota.hasOwnProperty(i)&&i-0!=curQuotaId&&null==this.quota[i].qtState&&-1!=$j.inArray(catId,this.quota[i].cat))return!0;return!1},getEligGrpCat2Arr:function(catArr,grpArr,qId,exemptSslCats){var i,k,grpId,grpIdStr,category;for(k=0;k<this.grps.length;k++)for(grpIdStr=this.grps[k].id,grpId=parseInt(grpIdStr),i=0;i<this.cats[grpId].length;i++)category=this.cats[grpId][i],!this.eligCat4QuotaByAct(category.actionCode)||null!=exemptSslCats&&-1!=$j.inArray(category.id,exemptSslCats)||qId&&this.catInOtherQuota(category.id,qId)||(catArr.push(new QuotaCat(category,grpId)),null==grpArr[grpId]&&(grpArr[grpId]=this.grps[k]))},newEditQuota:function(dialog_fn,curQuotaId,quotaData){var eligCat=[],eligGrp=[],exemptSslCats=[];return exemptSslCats=$j.map($j(":checkbox[id^=exemptSsl_]:checked"),function(v){return v.value-0}),this.getEligGrpCat2Arr(eligCat,eligGrp,curQuotaId,exemptSslCats),eligCat.length<=0?void alert($j.getInfo("err_no_elig_cat")):(this.eligCat=eligCat,this.eligGrp=$j.grep(eligGrp,function(o){return!!o}),this.curQuotaData=quotaData,void dialog_fn(curQuotaId))},sortGroups:function(a,b){return parseInt(a.id)-parseInt(b.id)},getChkedCats4Quota:function(){var eligCats=[],catsNode=this.tree.get_checked();return catsNode.forEach(function(id){this.tree.is_leaf(id)&&eligCats.push(id-0)}.bind(this)),eligCats},updateQuota:function(quotaId,chkedCats,quotaData){void 0===this.quota[quotaId]?this.quota[quotaId]=new FtgdQuota(quotaId,quotaData):(this.quota[quotaId].type=quotaData.type,this.quota[quotaId].dur=quotaData.dur,this.quota[quotaId].value=quotaData.value,this.quota[quotaId].unit=quotaData.unit),this.quota[quotaId].hasOwnProperty("type")||(this.quota[quotaId].type="time"),this.quota[quotaId].cat=chkedCats,this.quota[quotaId].catHex=$j.map(chkedCats,function(v){return getHexNum(v)})}};